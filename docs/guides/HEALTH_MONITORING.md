# System Health Monitoring - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

## –ß—Ç–æ —ç—Ç–æ?

**reflection_node** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç –∑–¥–æ—Ä–æ–≤—å–µ –≤—Å–µ—Ö ROS2 –Ω–æ–¥ —á–µ—Ä–µ–∑ —Ç–æ–ø–∏–∫ `/rosout`.

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
# –ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏ reflection_node - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É–∂–µ –≤—Å—Ç—Ä–æ–µ–Ω!
ros2 launch rob_box_perception internal_dialogue.launch.py
```

**reflection_node** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- ‚úÖ –°–ª—É—à–∞–µ—Ç `/rosout` (–≤—Å–µ –ª–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã)
- ‚úÖ –°–æ–±–∏—Ä–∞–µ—Ç ERROR –∏ WARN –æ—Ç –≤—Å–µ—Ö –Ω–æ–¥
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ç–æ–ø–∏–∫–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç `system_health` –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è AI
- ‚úÖ –°–æ–æ–±—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö

### –†—É—á–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å health monitor –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
ros2 run rob_box_perception health_monitor
```

**–í—ã–≤–æ–¥–∏—Ç –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥:**
```
======================================================================
üè• HEALTH REPORT
======================================================================
Status: ‚ö†Ô∏è  DEGRADED
Total Errors: 3 (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –∑–∞ –º–∏–Ω—É—Ç—É)
Total Warnings: 5

--- Recent Errors ---
  [ERROR] oak_d_node (15s ago): Failed to read frame from camera
  [ERROR] rtabmap (45s ago): Map optimization failed

--- Recent Warnings ---
  [WARN] nav2_controller (10s ago): Goal tolerance exceeded
  [WARN] battery_monitor (25s ago): Low battery voltage detected
======================================================================
```

## Health Statuses

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ | –î–µ–π—Å—Ç–≤–∏—è —Ä–æ–±–æ—Ç–∞ |
|--------|----------|-----------------|
| ‚úÖ **HEALTHY** | –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ | –ú–æ–ª—á–∏—Ç |
| ‚ö†Ô∏è **DEGRADED** | –ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã (5+ –æ—à–∏–±–æ–∫ –∑–∞ –º–∏–Ω—É—Ç—É, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∞–Ω–Ω—ã—Ö) | –ú–æ–∂–µ—Ç —Å–æ–æ–±—â–∏—Ç—å, –µ—Å–ª–∏ –≤–∞–∂–Ω–æ |
| üö® **CRITICAL** | –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ (FATAL, fail, crash) | **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** —Å–æ–æ–±—â–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é |

## –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–∫—Ü–∏–π —Ä–æ–±–æ—Ç–∞

### Critical
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ü–æ—á–µ–º—É —Ç—ã —Å—Ç–æ–∏—à—å?"
–†–æ–±–æ—Ç: "–£ –º–µ–Ω—è –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–∞–º–µ—Ä–æ–π, –Ω–µ –º–æ–≥—É –≤–∏–¥–µ—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ. –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å!"
```

### Degraded
```
# –†–æ–±–æ—Ç –∑–∞–º–µ—á–∞–µ—Ç –º–Ω–æ–≥–æ –æ—à–∏–±–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
–†–æ–±–æ—Ç: "–ú–Ω–æ–≥–æ –æ—à–∏–±–æ–∫ –≤ SLAM, –≤–æ–∑–º–æ–∂–Ω–æ –∫–∞—Ä—Ç–∞ —É—Å—Ç–∞—Ä–µ–ª–∞. –ü–µ—Ä–µ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å?"
```

### Healthy
```
# –í—Å—ë –û–ö - —Ä–æ–±–æ—Ç –ù–ï –∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏
# –ì–æ–≤–æ—Ä–∏—Ç —Ç–æ–ª—å–∫–æ –æ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö (–Ω–∏–∑–∫–∞—è –±–∞—Ç–∞—Ä–µ—è, –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —á–µ–ª–æ–≤–µ–∫–∞)
```

## –ß—Ç–æ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç AI?

```json
{
  "system_health": {
    "status": "degraded",
    "issues": [
      "‚ö†Ô∏è  5 –æ—à–∏–±–æ–∫ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–Ω—É—Ç—É",
      "üëÅÔ∏è  –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö —Å –∫–∞–º–µ—Ä—ã"
    ],
    "recent_errors": [
      {
        "node": "oak_d_node",
        "level": "ERROR",
        "message": "Failed to read frame",
        "timestamp": 1697123456.78
      }
    ],
    "recent_warnings": [
      {
        "node": "nav2_controller",
        "message": "Goal tolerance exceeded",
        "timestamp": 1697123450.12
      }
    ]
  }
}
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–ø–∏–∫–æ–≤

reflection_node –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç (–∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥):
- üëÅÔ∏è `/perception/vision_context` - –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ —Å –∫–∞–º–µ—Ä—ã?
- üöó `/odom` - —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –æ–¥–æ–º–µ—Ç—Ä–∏—è?

–ï—Å–ª–∏ —Ç–æ–ø–∏–∫ –¥–æ–ª–≥–æ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `system_health.issues`

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥–∏–∞–ª–æ–≥–æ–º

### –ü—Ä–∏–º–µ—Ä 1: –ö—Ä–∏—Ç–∏—á–Ω–∞—è –æ—à–∏–±–∫–∞
```python
# reflection_node –≤–∏–¥–∏—Ç –≤ /rosout:
[FATAL] camera_driver: "Device disconnected!"

# AI –ø–æ–ª—É—á–∞–µ—Ç:
system_health = {
  "status": "critical",
  "issues": ["üö® 1 –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫ –∑–∞ 30 —Å–µ–∫"],
  "recent_errors": [{"node": "camera_driver", "level": "FATAL", ...}]
}

# DeepSeek —Ä–µ—à–∞–µ—Ç:
{
  "thought": "–ö–∞–º–µ—Ä–∞ –æ—Ç–∫–ª—é—á–∏–ª–∞—Å—å, —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏",
  "should_speak": true,
  "speech": "–í–Ω–∏–º–∞–Ω–∏–µ! –ö–∞–º–µ—Ä–∞ –æ—Ç–∫–ª—é—á–∏–ª–∞—Å—å, —è –Ω–µ –º–æ–≥—É –≤–∏–¥–µ—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ"
}
```

### –ü—Ä–∏–º–µ—Ä 2: Degraded, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ
```python
# –ú–Ω–æ–≥–æ WARNING –æ—Ç Nav2
system_health = {
  "status": "degraded",
  "issues": ["‚ö†Ô∏è  10 –æ—à–∏–±–æ–∫ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–Ω—É—Ç—É"]
}

# DeepSeek —Ä–µ—à–∞–µ—Ç:
{
  "thought": "Nav2 –≤—ã–¥–∞—ë—Ç –º–Ω–æ–≥–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π, –Ω–æ –ø–æ–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç",
  "should_speak": false,  # –ù–ï —Å–æ–æ–±—â–∞—Ç—å –ø–æ–∫–∞
  "speech": ""
}
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–π –æ—à–∏–±–∫–∏
```bash
# –≠–º—É–ª–∏—Ä—É–µ–º ERROR –æ—Ç –∫–∞–º–µ—Ä—ã
ros2 topic pub /rosout rcl_interfaces/msg/Log \
  "{level: 40, name: 'test_node', msg: 'Camera FAIL!'}" \
  --once

# –°–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ reflection_node
ros2 topic echo /reflection/internal_thought
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```bash
# Terminal 1: Health monitor
ros2 run rob_box_perception health_monitor

# Terminal 2: –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –º—ã—Å–ª–∏
ros2 topic echo /reflection/internal_thought

# Terminal 3: –†–µ—á—å —Ä–æ–±–æ—Ç–∞
ros2 topic echo /voice/tts/request
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–í `docker-compose.yaml` –∏–ª–∏ launch —Ñ–∞–π–ª–µ:
```yaml
environment:
  # –ß–∞—Å—Ç–æ—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è (–≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ reflection rate)
  REFLECTION_RATE: "1.0"  # 1 Hz = –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
```

reflection_node –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ø–∏–∫–∏ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

## –û—Ç–ª–∞–¥–∫–∞

### –°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –ª–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã
```bash
ros2 topic echo /rosout
```

### –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
```bash
ros2 topic echo /rosout | grep "level: 40\|level: 50"
```

### –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –Ω–æ–¥
```bash
ros2 node list
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –ª–∏ –≤–∞–∂–Ω—ã–µ —Ç–æ–ø–∏–∫–∏
```bash
ros2 topic hz /perception/vision_context
ros2 topic hz /odom
```

## Best Practices

1. **–ù–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–π –ª–æ–≥–∞–º–∏** - reflection_node –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —Å–≤–æ–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –ª–æ–≥–∏
2. **FATAL = –∫—Ä–∏—Ç–∏—á–Ω–æ** - –∏—Å–ø–æ–ª—å–∑—É–π —É—Ä–æ–≤–µ–Ω—å 50 —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –∞–≤–∞—Ä–∏–π
3. **ERROR = –≤–∞–∂–Ω–æ** - –∏—Å–ø–æ–ª—å–∑—É–π —É—Ä–æ–≤–µ–Ω—å 40 –¥–ª—è –æ—à–∏–±–æ–∫ —Ç—Ä–µ–±—É—é—â–∏—Ö –≤–Ω–∏–º–∞–Ω–∏—è
4. **WARN = FYI** - –∏—Å–ø–æ–ª—å–∑—É–π —É—Ä–æ–≤–µ–Ω—å 30 –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
5. **health_monitor** - –∑–∞–ø—É—Å–∫–∞–π –ø—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ, –Ω–µ –Ω—É–∂–µ–Ω –≤ production

## FAQ

**Q: –ë—É–¥–µ—Ç –ª–∏ —Ä–æ–±–æ—Ç –±–æ–ª—Ç–∞—Ç—å –æ –∫–∞–∂–¥–æ–π –æ—à–∏–±–∫–µ?**
A: –ù–ï–¢! DeepSeek AI —Ä–µ—à–∞–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ critical –∏–ª–∏ –≤–∞–∂–Ω—ã—Ö degraded —Å–ª—É—á–∞—è—Ö.

**Q: –ö–∞–∫ –æ—Ç–∫–ª—é—á–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥?**
A: –ù–µ–ª—å–∑—è –æ—Ç–∫–ª—é—á–∏—Ç—å - —ç—Ç–æ —á–∞—Å—Ç—å reflection_node. –ù–æ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å system_prompt —á—Ç–æ–±—ã AI –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª system_health.

**Q: –í–ª–∏—è–µ—Ç –ª–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å?**
A: –ù–µ—Ç. `/rosout` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –º—ã –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è. –•—Ä–∞–Ω–∏–º max 10 errors + 5 warnings –≤ –ø–∞–º—è—Ç–∏.

**Q: –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —ç—Ç–æ —Å Zenoh bridge?**
A: –î–ê! `/rosout` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ Zenoh bridge –º–µ–∂–¥—É Main Pi –∏ Vision Pi.

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ

–ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏ `internal_dialogue.launch.py` –∏ —Ä–æ–±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–Ω—ë—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º—É.
