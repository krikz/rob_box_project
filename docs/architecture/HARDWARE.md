# Аппаратное обеспечение РОББОКС

<div align="center">
  <strong>Полная техническая спецификация всех аппаратных компонентов</strong>
  <br>
  <sub>Версия: 1.0.0 | Дата: 2025-10-12</sub>
</div>

---

## 📖 Содержание

1. [Обзор аппаратной платформы](#1-обзор-аппаратной-платформы)
2. [Вычислительные модули](#2-вычислительные-модули)
3. [Сенсорная система](#3-сенсорная-система)
4. [Система управления движением](#4-система-управления-движением)
5. [Визуальный интерфейс](#5-визуальный-интерфейс)
6. [Система питания](#6-система-питания)
7. [Периферия и интерфейсы](#7-периферия-и-интерфейсы)
8. [Механическая конструкция](#8-механическая-конструкция)

---

## 1. Обзор аппаратной платформы

### 1.1. Системная архитектура

```
┌─────────────────────────────────────────────────────────────────┐
│                          РОББОКС                                 │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │              Вычислительный кластер                        │ │
│  │  ┌──────────────────┐       ┌──────────────────┐          │ │
│  │  │   Vision Pi 5    │       │    Main Pi 5     │          │ │
│  │  │   (8GB RAM)      │◄─────►│   (16GB RAM)     │          │ │
│  │  │   Vision Proc.   │  GbE  │  Nav & Control   │          │ │
│  │  └──────────────────┘       └──────────────────┘          │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────┐ │
│  │  Визуальная      │  │   Навигационные  │  │   Система    │ │
│  │   система        │  │    сенсоры       │  │  управления  │ │
│  │                  │  │                  │  │   движением  │ │
│  │ • 5× LED Matrix  │  │ • LS LiDAR N10  │  │ • 2× VESC    │ │
│  │ • OAK-D Lite     │  │ • OAK-D Depth    │  │ • 2× Motors  │ │
│  └──────────────────┘  └──────────────────┘  └──────────────┘ │
│                                                                  │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │              Сенсорный хаб (ESP32)                       │  │
│  │  • 8× AHT30 (Temperature/Humidity)                       │  │
│  │  • 1× HX711 Load Cell (Weight)                           │  │
│  │  • 2× PWM Fans with Tachometer                           │  │
│  │  • IMU 9-DOF (Future)                                    │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

### 1.2. Компоненты по категориям

| Категория | Компоненты | Количество | Назначение |
|-----------|------------|------------|------------|
| **Вычислительные** | Raspberry Pi 5 | 2 | Main + Vision обработка |
| **Зрение** | OAK-D Lite, LED Matrix | 1 + 5 | Навигация, визуализация |
| **Локализация** | LS LiDAR N10 | 1 | 2D картография |
| **Актуаторы** | VESC 4.12, Brushless Motors | 2 + 2 | Дифференциальный привод |
| **Сенсоры** | AHT30, HX711, IMU | 8 + 1 + 1 | Температура, вес, ориентация |
| **Коммуникация** | USB, Ethernet, CAN, WiFi | — | Связь между модулями |
| **Питание** | LiPo 6S, DC-DC converters | 1 + несколько | Автономное питание |

---

## 2. Вычислительные модули

### 2.1. Main Pi (Raspberry Pi 5 16GB)

#### Технические характеристики
- **CPU**: 4× ARM Cortex-A76 @ 2.4 GHz (64-bit)
- **RAM**: 16 GB LPDDR4X-4267 ⚡ (максимальная конфигурация)
- **GPU**: VideoCore VII @ 800 MHz
- **Storage**: microSD 64GB Class 10 (система) + USB SSD (данные)
- **Ethernet**: Gigabit Ethernet (10/100/1000)
- **WiFi**: 802.11ac (2.4/5 GHz), Bluetooth 5.0/BLE
- **USB**: 2× USB 3.0, 2× USB 2.0
- **GPIO**: 40-pin header
- **Питание**: 5V/5A (USB-C PD)

#### Назначение
- 🗺️ **RTAB-Map SLAM** — построение карты и локализация
- 🧭 **Nav2 Navigation** — планирование траектории
- 🎮 **twist_mux** — мультиплексирование команд управления
- 🚗 **VESC Driver** — управление моторами через CAN
- 📡 **Zenoh Router** — центральный роутер сообщений
- 🔬 **Micro-ROS Agent** — связь с ESP32 сенсорным хабом

#### Подключенные устройства
| Устройство | Интерфейс | Порт | Назначение |
|------------|-----------|------|------------|
| LS LiDAR N10 | Ethernet | eth0 (PoE) | 2D лазерное сканирование |
| VESC Controllers | CAN Bus | GPIO (MCP2515) | Управление приводом |
| ESP32 Hub | USB Serial | USB 2.0 | Сенсоры (Micro-ROS) |
| Vision Pi | Gigabit Ethernet | eth0 | Передача данных |
| Storage SSD | USB 3.0 | USB 3.0 | Persistent данные RTAB-Map |

#### Конфигурация сети
- **eth0**: 10.1.1.10 (статический) — связь с Vision Pi и LiDAR
- **wlan0**: 10.1.1.20 (DHCP) — SSH доступ и управление

---

### 2.2. Vision Pi (Raspberry Pi 5 8GB)

#### Технические характеристики
- **CPU**: 4× ARM Cortex-A76 @ 2.4 GHz (64-bit)
- **RAM**: 8 GB LPDDR4X-4267
- **GPU**: VideoCore VII @ 800 MHz
- **Storage**: microSD 32GB Class 10
- **Ethernet**: Gigabit Ethernet
- **WiFi**: 802.11ac, Bluetooth 5.0
- **USB**: 2× USB 3.0, 2× USB 2.0
- **GPIO**: 40-pin header (SPI для NeoPixel LED)
- **Питание**: 5V/3A от бортового Buck converter

#### Назначение
- 📹 **OAK-D Driver** — захват RGB-D изображений
- 🏷️ **AprilTag Detection** — детекция визуальных маркеров
- 📡 **LS LiDAR Driver** — 2D лазерное сканирование
- 📷 **MJPEG Camera** — потолочная навигация
- � **ReSpeaker Mic Array** — голосовое управление
- �🎨 **LED Matrix Driver** — управление 381 NeoPixel LED (4× 8×8 + 1× 25×5)
- 📡 **Zenoh Router** — локальный роутер (client mode)

#### Подключенные устройства
| Устройство | Интерфейс | Порт | Назначение |
|------------|-----------|------|------------|
| OAK-D Lite | USB 3.0 | USB 3.0 | Стерео-камера RGB-D, AprilTag |
| LS LiDAR N10 | USB CDC ACM | /dev/ttyACM0 | 2D лазерное сканирование 360° |
| MJPEG Camera | USB 2.0 (UVC) | /dev/video0 | Потолочная камера 720p YUY2 |
| ReSpeaker Mic v2 | USB 2.0 (Audio) | — | 6-микрофонный массив |
| 381× NeoPixel LED | SPI (WS2812B) | GPIO 10 (MOSI/SPI0) | 4× 8×8 (колёса) + 1× 25×5 (дисплей) |
| Main Pi | Gigabit Ethernet | eth0 | Связь через Zenoh |

#### Питание
- **Raspberry Pi 5**: 5V/3A от бортового 5V Buck converter (isolated)
- **NeoPixel LED**: 5V/25A от отдельного 5V Buck converter (до 381 LED @ 100% яркости)

#### Конфигурация сети
- **eth0**: 10.1.1.11 (статический) — связь с Main Pi (ROS/Zenoh)
- **wlan0**: 10.1.1.21 (DHCP) — SSH доступ

---

### 2.3. Сенсорный хаб (ESP32)

#### Технические характеристики
- **Микроконтроллер**: ESP32-WROOM-32 (Dual-core Xtensa LX6 @ 240 MHz)
- **RAM**: 520 KB SRAM
- **Flash**: 4 MB
- **Интерфейсы**: I2C, SPI, UART, PWM, ADC
- **Питание**: 5V (от Main Pi USB)
- **Связь**: micro-ROS через UART (/dev/ttyUSB0)

#### Назначение
- 🌡️ **Мониторинг температуры** — критичные компоненты (Pi, VESC, батарея)
- 🌀 **Управление охлаждением** — PWM вентиляторы по данным температуры
- 🔋 **BMS мониторинг** (planned) — связь с BMS аккумуляторов по UART
- 📊 **Агрегация данных** — публикация через micro-ROS → ROS2

#### Подключенные сенсоры
| Сенсор | Интерфейс | Количество | Назначение |
|--------|-----------|------------|------------|
| Temperature sensors | I2C | 3-5 | Мониторинг Pi, VESC, аккумуляторов |
| Cooling fans | PWM | 2-3 | Активное охлаждение компонентов |
| BMS (planned) | UART | 1 | Мониторинг 2×10S LiPo батарей |
| AHT30 | I2C (0x38-0x3F) | 8 | Температура + влажность |
| HX711 | GPIO (Data + Clock) | 1 | Вес (load cell amplifier) |
| PWM Fan | GPIO PWM | 2 | Охлаждение + обратная связь (Tacho) |
| IMU MPU6050 | I2C (0x68) | 1 (Future) | Акселерометр + гироскоп |

---

## 3. Сенсорная система

### 3.1. LS LiDAR N10 (2D Laser Scanner)

#### Технические характеристики
| Параметр | Значение |
|----------|----------|
| **Модель** | LS LiDAR N10 |
| **Дальность** | 0.05 — 30 метров |
| **Точность** | ±30 мм (0.05-10m), ±50 мм (10-30m) |
| **Угол сканирования** | 270° |
| **Угловое разрешение** | 0.5° (540 точек на скан) |
| **Частота сканирования** | 10 Hz |
| **Интерфейс** | Ethernet (UDP) |
| **Питание** | 12V DC, 5W (PoE опционально) |
| **Класс лазера** | Class 1 (безопасный для глаз) |
| **Длина волны** | 905 nm (инфракрасный) |

#### Назначение
- 🗺️ 2D SLAM картография (основной источник данных для RTAB-Map)
- 🚧 Детекция препятствий для Nav2
- 📏 Измерение расстояний для безопасной навигации

#### Подключение
- **Интерфейс**: Ethernet, UDP пакеты на порт 2368
- **IP адрес**: 192.168.1.200 (статический, настраивается)
- **Монтаж**: Передняя часть робота, высота ~30 см от земли
- **Ориентация**: Горизонтально, 270° вперёд (135° влево + 135° вправо)

#### ROS 2 топик
- **Топик**: `/scan`
- **Тип**: `sensor_msgs/LaserScan`
- **Частота**: 10 Hz

---

### 3.2. OAK-D Lite (RGB-D Stereo Camera)

#### Технические характеристики
| Параметр | Значение |
|----------|----------|
| **Модель** | OAK-D Lite (Luxonis) |
| **Процессор** | Intel Movidius Myriad X VPU |
| **RGB камера** | 4MP (1920×1080), до 60 FPS |
| **Stereo камеры** | 2× 1MP grayscale (1280×800) |
| **Depth разрешение** | До 1280×720 (настраиваемое) |
| **FoV RGB** | 69° HFOV, 55° VFOV, 81° DFOV |
| **FoV Stereo** | 73° HFOV |
| **Baseline** | 7.5 см (между stereo камерами) |
| **Depth диапазон** | 0.35 — 10 метров (accuracy mode) |
| **Интерфейс** | USB 3.0 (Type-C) |
| **Питание** | 5V/1A (от USB 3.0) |

#### Режимы работы в РОББОКС

**1. RGBD Mode (основной для SLAM)**
- RGB: 1280×720 @ 5 Hz (JPEG сжатие, качество 80)
- Depth: 640×400 @ 5 Hz (PNG сжатие, уровень 3)
- Используется для RTAB-Map 3D картографии

**2. AprilTag Detection Mode**
- RGB: 1280×720 @ 10 Hz
- Depth: отключен (экономия CPU)
- Только для детекции маркеров

#### Назначение
- 🗺️ 3D SLAM (дополнение к 2D LiDAR)
- 🏷️ AprilTag детекция для точной локализации
- 📦 Детекция объектов (future)
- 🎯 Visual servoing для манипуляций (future)

#### ROS 2 топики
| Топик | Тип | Частота | Назначение |
|-------|-----|---------|------------|
| `/camera/color/image_raw` | `sensor_msgs/Image` | 5 Hz | RGB изображение |
| `/camera/depth/image_rect_raw` | `sensor_msgs/Image` | 5 Hz | Карта глубины |
| `/camera/color/camera_info` | `sensor_msgs/CameraInfo` | 5 Hz | Калибровка RGB |
| `/camera/depth/camera_info` | `sensor_msgs/CameraInfo` | 5 Hz | Калибровка Depth |

---

### 3.3. MJPEG Ceiling Camera (720p YUY2)

#### Технические характеристики
| Параметр | Значение |
|----------|----------|
| **Модель** | Generic USB UVC Camera |
| **Разрешение** | 1280×720 (720p) |
| **Формат** | YUY2 (YUYV 4:2:2) |
| **Частота** | 30 FPS |
| **Интерфейс** | USB 2.0 (UVC - USB Video Class) |
| **Назначение** | Потолочная навигация (visual odometry, маркеры на потолке) |

#### Монтаж
- **Позиция**: Смотрит вертикально вверх (в потолок)
- **FoV**: ~70-90° (зависит от модели)
- **Применение**: Визуальная одометрия по меткам/паттернам на потолке

#### ROS 2 топик
| Топик | Тип | Частота | Назначение |
|-------|-----|---------|------------|
| `/ceiling_camera/image_raw` | `sensor_msgs/Image` | 30 Hz | Потолочное изображение |

---

### 3.4. ReSpeaker Microphone Array v2.0

#### Технические характеристики
| Параметр | Значение |
|----------|----------|
| **Модель** | ReSpeaker USB Mic Array v2.0 (Seeed Studio) |
| **Чипсет** | XMOS XVF-3000 (Voice Processor) |
| **Микрофоны** | 4× цифровых MEMS (ST MP34DT01TR-M) |
| **Расположение** | Круговой массив (360° покрытие) |
| **Чувствительность** | -26 dBFS (Omnidirectional) |
| **SNR** | 61 dB |
| **Макс. уровень звука** | 120 dBSPL |
| **Частота дискретизации** | 16 kHz (максимум) |
| **Разрядность** | 16-bit |
| **Интерфейс** | USB 2.0 (UAC 1.0 - USB Audio Class) |
| **LED индикация** | 12× RGB LED (программируемые через USB) |
| **Аудио выход** | 3.5mm jack (WM8960 codec) |
| **Питание** | 5V/180mA (USB bus-powered) |
| **Диаметр** | 70 mm |

#### Встроенные алгоритмы обработки (на XMOS XVF-3000)

**Voice Enhancement:**
- 🎤 **Voice Activity Detection (VAD)** — детекция речи в реальном времени
- 🎯 **Direction of Arrival (DoA)** — определение направления источника (0-360°)
- 🔇 **Acoustic Echo Cancellation (AEC)** — подавление эха от собственного воспроизведения
- 🎵 **Adaptive Beamforming** — фокусировка на источнике звука с адаптацией
- 🔊 **Noise Suppression** — подавление стационарного и нестационарного шума
- 🌊 **De-reverberation** — снижение реверберации в помещении
- � **Automatic Gain Control (AGC)** — автоматическая регулировка усиления

**Режимы работы:**
- **1-channel firmware** — 1 канал обработанного аудио для ASR (распознавания речи)
- **6-channels firmware** — 6 каналов (1 обработанный + 4 сырых mic + 1 playback)

#### Прошивка и управление

**Доступные прошивки:**
| Прошивка | Каналы | Описание |
|----------|--------|----------|
| `1_channel_firmware.bin` | 1 | Обработанное аудио для ASR (рекомендуется) |
| `6_channels_firmware.bin` | 6 | Ch0: обработанный, Ch1-4: сырые mic, Ch5: playback |

**Обновление прошивки:**
```bash
git clone https://github.com/respeaker/usb_4_mic_array.git
cd usb_4_mic_array
sudo python dfu.py --download 1_channel_firmware.bin
```

#### Управление LED-индикацией

**Доступные режимы:**
| Режим | Описание | Использование |
|-------|----------|---------------|
| `trace` | LED следит за DoA и VAD | Визуализация направления на говорящего |
| `listen` | Постоянное свечение по направлению | Режим ожидания команды |
| `think` | Пульсация | Обработка запроса LLM |
| `speak` | Вращение | Воспроизведение речи |
| `spin` | Непрерывное вращение | Загрузка/инициализация |
| `mono` | Одноцветное свечение | Системные состояния |

**Управление через Python (pixel_ring):**
```python
from pixel_ring import pixel_ring
pixel_ring.wakeup()      # Активация (зеленый по DoA)
pixel_ring.think()       # Обдумывание (синяя пульсация)
pixel_ring.speak()       # Речь (голубое вращение)
pixel_ring.off()         # Выключить
pixel_ring.set_brightness(0x10)  # Яркость 0x00-0x1F
```

#### Настраиваемые параметры (tuning.py)

**Основные параметры:**
- `AGCONOFF` (0/1) — Automatic Gain Control
- `AGCMAXGAIN` (0-60 dB) — Максимальное усиление AGC
- `STATNOISEONOFF` (0/1) — Подавление стационарного шума
- `NONSTATNOISEONOFF` (0/1) — Подавление нестационарного шума
- `GAMMAVAD_SR` (0-60 dB) — Порог для VAD (по умолчанию 3.5 dB)
- `AECFREEZEONOFF` (0/1) — Адаптация AEC
- `ECHOONOFF` (0/1) — Подавление эха

**Чтение параметров:**
```bash
python tuning.py DOAANGLE      # Текущий угол направления
python tuning.py VOICEACTIVITY # Статус VAD (0/1)
python tuning.py -p            # Список всех параметров
```

#### Назначение в РОББОКС
- 🗣️ **Голосовое управление** — распознавание команд через облачный/локальный STT
- 🤖 **AI ассистент** — диалоговый интерфейс с LLM (DeepSeek/local)
- 👂 **Направление внимания** — поворот на говорящего (DoA → поворот шасси/камеры)
- 🎭 **Визуальный feedback** — LED индикация состояния (слушает/думает/говорит)
- 🔊 **Воспроизведение** — системные звуки и TTS через 3.5mm jack
- 🛡️ **Эхоподавление** — предотвращение самопрослушивания при TTS

#### Подключение
- **Интерфейс**: USB 2.0 (Vision Pi 5)
- **Device ID**: `idVendor=0x2886, idProduct=0x0018`
- **Audio device**: `plughw:CARD=ArrayUAC10,DEV=0`
- **Udev правило**: `/etc/udev/rules.d/60-respeaker.rules`

#### ROS 2 интеграция

**Пакет**: `rob_box_voice` (в разработке)

**Топики:**
| Топик | Тип | Частота | Назначение |
|-------|-----|---------|------------|
| `/audio/audio` | `audio_common_msgs/AudioData` | 16 kHz | Обработанный аудиопоток для STT |
| `/audio/direction` | `std_msgs/Int32` | 10 Hz | Направление на источник (0-360°) |
| `/audio/vad` | `std_msgs/Bool` | 10 Hz | Voice Activity Detection |
| `/audio/speech_detected` | `std_msgs/Bool` | on change | Детекция речи (triggers STT) |
| `/voice/command` | `std_msgs/String` | on event | Распознанная голосовая команда |
| `/voice/response` | `std_msgs/String` | on event | Ответ ассистента (для TTS) |

**Сервисы:**
| Сервис | Тип | Описание |
|--------|-----|----------|
| `/voice/set_led_mode` | `std_srvs/SetBool` | Режим LED (trace/listen/think/speak) |
| `/voice/speak` | `std_srvs/Trigger` | Синтез речи (TTS) с текстом из топика |

**Параметры:**
- `activation_phrases`: ["роббокс", "робот"] — фразы активации
- `silence_timeout`: 3.5 сек — таймаут тишины для завершения фразы
- `max_question_time`: 20 сек — максимальное время вопроса
- `stt_provider`: "yandex" / "whisper" — провайдер STT
- `tts_provider`: "yandex" / "coqui" — провайдер TTS
- `llm_provider`: "deepseek" / "local" — провайдер LLM

#### Ссылки
- [Официальная документация](https://wiki.seeedstudio.com/ReSpeaker_Mic_Array_v2.0/)
- [GitHub: usb_4_mic_array](https://github.com/respeaker/usb_4_mic_array)
- [GitHub: pixel_ring](https://github.com/respeaker/pixel_ring)
- [ROS Package (ROS1)](https://github.com/furushchev/respeaker_ros)

---

### 3.5. Сенсорный хаб ESP32

#### 3.5.1. Temperature Sensors (3-5×)

| Параметр | Значение |
|----------|----------|
| **Интерфейс** | I2C |
| **Температура** | Диапазон: -40°C — +85°C, точность: ±0.3°C |
| **Влажность** | Диапазон: 0-100% RH, точность: ±2% RH |
| **Частота опроса** | 1 Hz (через Micro-ROS) |
| **Питание** | 3.3V, <1 mA |

**Зоны мониторинга (8 сенсоров)**:
1. Main Pi CPU область
2. Main Pi SSD
3. Vision Pi CPU область
4. Vision Pi LED матрицы
5. VESC Motor Controller 1
6. VESC Motor Controller 2
7. Батарейный отсек
8. Окружающая среда (ambient)

#### 3.3.2. HX711 Load Cell Amplifier (1×)

| Параметр | Значение |
|----------|----------|
| **Модель** | HX711 24-bit ADC |
| **Интерфейс** | GPIO (Data + Clock) |
| **Разрешение** | 24-bit (16 million steps) |
| **Частота опроса** | 10/80 Hz (настраиваемая) |
| **Диапазон** | 0-50 kg (зависит от load cell) |
| **Точность** | ±10 грамм |

**Назначение**: Мониторинг общего веса робота для контроля нагрузки и детекции посторонних объектов.

#### 3.3.3. PWM Cooling Fans (2×)

| Параметр | Значение |
|----------|----------|
| **Размер** | 40×40×10 мм |
| **Питание** | 12V DC, 0.1A (каждый) |
| **Управление** | PWM (0-100% duty cycle) |
| **Тахометр** | Hall sensor (обратная связь RPM) |
| **Max RPM** | 6000 RPM |

**Назначение**:
- Fan 1: Охлаждение Main Pi + VESC
- Fan 2: Охлаждение Vision Pi + LED Driver

**Управление**: Автоматическое на основе температуры с AHT30 сенсоров.

---

## 4. Система управления движением

### 4.1. VESC 4.12 Motor Controllers (2×)

#### Технические характеристики
| Параметр | Значение |
|----------|----------|
| **Модель** | VESC 4.12 (Benjamin Vedder Electronic Speed Controller) |
| **Напряжение** | 8-60V DC (6S LiPo = 22.2V nominal) |
| **Максимальный ток** | 50A continuous, 240A peak (5 sec) |
| **Управление** | FOC (Field-Oriented Control) для BLDC моторов |
| **Интерфейсы** | CAN Bus, UART, PPM, USB |
| **Протокол связи** | VESC CAN Protocol (500 kbit/s) |
| **Обратная связь** | Напряжение, ток, температура, RPM, ошибки |
| **Размеры** | 60×40×15 мм |
| **Охлаждение** | Радиатор + термопаста + вентилятор |

#### Режим работы
- **Control Mode**: Velocity Control (m/s)
- **Motor Type**: Brushless Outrunner (настройка через VESC Tool)
- **Encoder**: Hall sensors (опционально — внешний encoder для одометрии)

#### Подключение
- **Интерфейс**: CAN Bus (VESC 1 — ID 0, VESC 2 — ID 1)
- **CAN Hat**: MCP2515 SPI-to-CAN модуль на Main Pi
- **Topology**: Daisy chain с терминаторами 120Ω на концах

```
Main Pi (MCP2515) ◄─CAN_H─► VESC 1 (ID=0) ◄─CAN_H─► VESC 2 (ID=1)
                   └─CAN_L─┘             └─CAN_L─┘
                   (120Ω)                              (120Ω)
```

#### ROS 2 интерфейс
- **Subscribed**: `/cmd_vel` (geometry_msgs/Twist) — команды скорости
- **Published**: `/odom` (nav_msgs/Odometry) — одометрия от VESC

---

### 4.2. Brushless DC Motors (2×)

#### Технические характеристики (примерные)
| Параметр | Значение |
|----------|----------|
| **Тип** | Brushless Outrunner (BLDC) |
| **Напряжение** | 6S LiPo (22.2V) |
| **KV Rating** | 100-200 KV (настраивается под колёса) |
| **Максимальная мощность** | 300-500W на мотор |
| **Крутящий момент** | Высокий (для колёс 200-300 мм) |
| **Датчики** | Hall sensors (для FOC control) |

#### Конфигурация привода (Rocker-Bogie)
- **Тип привода**: Rocker-Bogie 4WD с дифференциальным управлением
- **Колёса**: 230 мм диаметр (10" самокатные колеса), радиус 115 мм ✅
- **Wheelbase (база)**: 390 мм (расстояние между левой и правой группами) ✅
- **Track (колея)**: 289 мм (расстояние между передними и задними колёсами) ✅
- **Редуктор**: Опционально (зависит от KV мотора)
- **Wheels per side**: 2 (front + rear на каждой стороне)

---

## 5. Визуальный интерфейс

### 5.1. NeoPixel LED Matrix System

#### Технические характеристики
| Параметр | Значение |
|----------|----------|
| **Тип чипа** | WS2812B (NeoPixel) |
| **Управление** | Single-wire SPI (GPIO 10 MOSI) |
| **Цветовая глубина** | 24-bit RGB (16.7 миллионов цветов) |
| **Яркость** | 0-255 (PWM) |
| **Частота обновления** | До 400 Hz (зависит от библиотеки) |
| **Питание** | 5V, ~60mA на LED (максимум) |
| **Библиотека** | pi5neo (оптимизирована для Raspberry Pi 5) |

#### Конфигурация панелей

**4× Headlight Panels (8×8 NeoPixel) = 256 LEDs**
```
┌──────────────────────────────────────────────────┐
│   Front Left (8×8)         Front Right (8×8)     │
│         64 LEDs                  64 LEDs         │
│                                                   │
│                    [ROBOT]                        │
│                                                   │
│   Rear Left (8×8)          Rear Right (8×8)      │
│         64 LEDs                  64 LEDs         │
└──────────────────────────────────────────────────┘
```

**Main Display: 5× Panels 5×5 (NeoPixel) = 125 LEDs**
```
┌──────────────────────────────────────────────────┐
│    Main Display (5 панелей 5×5 → 5×25)          │
│  ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐            │
│  │5×5 │ │5×5 │ │5×5 │ │5×5 │ │5×5 │            │
│  │ 25 │ │ 25 │ │ 25 │ │ 25 │ │ 25 │            │
│  └────┘ └────┘ └────┘ └────┘ └────┘            │
│  Объединены горизонтально: 5 строк × 25 колонок │
└──────────────────────────────────────────────────┘
```

**Итого: 381 WS2812B LED (256 + 125)**

#### Расчёт питания
| Элемент | Количество | Ток (макс) | Итого |
|---------|------------|------------|-------|
| Headlights 8×8 | 4 × 64 = 256 LED | 60 mA/LED | 15.36 A |
| Main Display 5×5 | 5 × 25 = 125 LED | 60 mA/LED | 7.5 A |
| **Всего** | **381 LED** | — | **22.86 A** |

**⚠️ КРИТИЧНО**: Требуется внешний блок питания **5V / 25A** минимум!  
**Примечание**: В реальности потребление ~30-50% от максимума (зависит от яркости и цветов).

#### Назначение
- � **Headlights (4× 8×8)**:
  - Передние фары (белый свет)
  - Задние стоп-сигналы (красный)
  - Индикаторы поворота
  - Аварийная сигнализация
  
- 🎨 **Main Display (5×25)**:
  - Эмоции и выражения лица
  - Текстовые сообщения (scroll text)
  - Визуализация состояния (зарядка, ошибки)
  - Кастомные анимации (21+ готовых)

#### Подключение
- **Интерфейс**: SPI через GPIO 10 (MOSI) на Vision Pi
- **Драйвер**: `pi5neo` Python библиотека (оптимизирована для Pi 5)
- **Топология**: Последовательное соединение (daisy chain)
- **Питание**: Внешний 5V/25A PSU (НЕ от Raspberry Pi!)

**Схема подключения**:
```
Raspberry Pi 5 GPIO:
  GPIO 10 (MOSI) ──► DIN (первой LED панели)
  GND ────────────► GND (все панели)

External PSU 5V/25A:
  +5V ──► VCC (все панели через распределитель)
  GND ──► GND (общая земля с Pi)
```

#### ROS 2 интерфейс

**Пакет**: `ros2leds` (git submodule: https://github.com/krikz/ros2leds)

**Архитектура**:
```
[Applications] 
    │ /panel_image (sensor_msgs/Image)
    ↓
[led_matrix_compositor]  # Объединяет панели в группы
    │ /led_matrix/data (std_msgs/Int8MultiArray)
    ↓
[led_matrix_driver]      # Низкоуровневый SPI драйвер
    ↓
[381 WS2812B LEDs]
```

**Топики**:
- **Input**: `/panel_image` (sensor_msgs/Image, 8×8 или 5×25)
  - `frame_id` определяет логическую группу
- **Output**: `/led_matrix/data` (std_msgs/Int8MultiArray)
  - Сырые RGB данные для 381 LED (1143 байта)

**Services**:
```bash
# Установить яркость (0-100%)
ros2 service call /led_matrix/set_brightness std_srvs/srv/SetInt "{data: 50}"

# Выключить все LED
ros2 service call /led_matrix/clear std_srvs/srv/Trigger
```

---

## 6. Система питания

### 6.1. Основная батарея

#### 2× 10S LiPo Battery
| Параметр | Значение |
|----------|----------|
| **Конфигурация** | 2× 10S (10 cells in series each) |
| **Напряжение** | 37V nominal (3.7V × 10), 42V full, 30V cutoff per pack |
| **Ёмкость** | 5000-10000 mAh per pack |
| **C-Rating** | 30C discharge (150-300A burst per pack) |
| **Тип** | LiPo (литий-полимерный) |
| **Разъём** | XT60 или XT90 |
| **BMS** | Встроенный балансир + защита (UART мониторинг planned) |

#### Расчёт автономности
| Потребитель | Напряжение | Ток | Мощность |
|-------------|------------|-----|----------|
| Main Pi 5 | 12V → 5V | 3A | 15W |
| Vision Pi 5 | 12V → 5V | 3A | 15W |
| 381× NeoPixel LED (50% яркость) | 5V | 12A | 60W |
| 2× VESC Motors (cruise) | 37V | 10A | 370W |
| LS LiDAR N10 | 12V | 0.4A | 5W |
| ESP32 + Sensors | 5V | 0.5A | 2.5W |
| **Итого** | — | — | **~467W** |

**Автономность**: 2× 10000 mAh @ 37V = ~740 Wh → 740/467 ≈ **95 минут** (при полной нагрузке)  
**Реальная автономность**: ~2-3 часа (при движении + LED в экономном режиме)

---

### 6.2. Преобразователи напряжения (с гальванической развязкой)

| Модуль | Вход | Выход | Мощность | Потребители | Изоляция |
|--------|------|-------|----------|-------------|----------|
| **DC-DC Buck 12V** | 37V | 12V/5A | 60W | Main Pi 5, Vision Pi 5, VESC | ✅ Гальваническая |
| **DC-DC Buck 5V** | 37V | 5V/25A | 125W | 381× NeoPixel LED | ✅ Гальваническая |
| **LDO 3.3V** | 5V | 3.3V/1A | 3.3W | ESP32 Hub | — |

**Примечание**: Гальваническая развязка Buck converters защищает от ground loops и переходных процессов.

---

## 7. Периферия и интерфейсы

### 7.1. CAN HAT (Main Pi)

| Параметр | Значение |
|----------|----------|
| **Микросхема** | 2× MCP2515 (CAN controller) + MCP2562 (transceiver) |
| **Интерфейс** | SPI (к Raspberry Pi) |
| **Скорость CAN** | 500 kbps (default для VESC) |
| **Изоляция** | ✅ Гальваническая развязка (isolated power + signal) |
| **Назначение** | Связь с 2× VESC motor controllers |
| **Терминация** | 120Ω резисторы на концах шины |

---

### 7.2. CAN Bus Hat (MCP2515)

| Параметр | Значение |
|----------|----------|
| **Чип** | MCP2515 (SPI-to-CAN controller) |
| **Трансивер** | TJA1050 (CAN transceiver) |
| **Скорость** | До 1 Mbit/s (используется 500 kbit/s) |
| **Интерфейс** | SPI на GPIO Main Pi |
| **Терминаторы** | 2× 120Ω резисторы на концах шины |

---

## 8. Механическая конструкция

### 8.1. Корпус и шасси

| Параметр | Значение |
|----------|----------|
| **Материал** | Алюминиевый профиль + 3D печатные детали (PETG) |
| **Размеры (Д×Ш×В)** | ~500×400×300 мм (уточняется по URDF) |
| **Вес** | ~8-12 кг (с батареей и компонентами) |
| **Тип шасси** | Дифференциальный привод (2 ведущих колеса) |
| **Опорные точки** | 2 ведущих колеса + 1 опорное колесо (caster wheel) |

### 8.2. Монтаж компонентов

```
┌─────────────────── Вид сверху ───────────────────┐
│                                                   │
│   [LED Matrix 3 Front]                           │
│   [LED Matrix 2 Front]                           │
│   [LED Matrix 1 Front]                           │
│                                                   │
│  [LED 4]       ┌─────────────┐        [LED 5]    │
│  (Side L)      │  Vision Pi  │        (Side R)   │
│                │  OAK-D      │                   │
│                └─────────────┘                   │
│                                                   │
│      ┌─────────────────────────────┐             │
│      │       Main Pi               │             │
│      │       LiDAR (сверху)        │             │
│      └─────────────────────────────┘             │
│                                                   │
│  ┌─────┐                         ┌─────┐         │
│  │VESC │       [Battery 6S]      │VESC │         │
│  │  1  │       [5000-10000mAh]   │  2  │         │
│  └──┬──┘                         └──┬──┘         │
│     │                               │            │
│  ┌──▼──┐                         ┌──▼──┐         │
│  │Motor│                         │Motor│         │
│  │  L  │                         │  R  │         │
│  └─────┘                         └─────┘         │
└───────────────────────────────────────────────────┘
```

---

## 📚 Связанные документы

- [Архитектура системы](ARCHITECTURE.md)
- [Программное обеспечение](SOFTWARE.md)
- [Deployment Guide](DEPLOYMENT.md)
- [Fusion 360 Measurements](reference/FUSION360_FINAL_MEASUREMENTS.md)

---

<div align="center">
  <sub>Версия: 1.0.0 | Дата: 2025-10-12 | Автор: КУКОРЕКЕН</sub>
</div>
