# Voice Assistant Docker Build Fix - 2025-10-24 (v2)

## –†–µ–∑—é–º–µ

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏ Docker –æ–±—Ä–∞–∑–∞ `voice-assistant` –ø—Ä–∏ cross-compilation (ARM64 on x86_64).

## üîß –ü—Ä–æ–±–ª–µ–º–∞

### –û—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏
```
CMake Error at /opt/ros/humble/share/rcutils/cmake/ament_cmake_export_libraries-extras.cmake:48 (message):
  Package 'rcutils' exports the library 'rcutils' which couldn't be found
Call Stack (most recent call first):
  /opt/ros/humble/share/rcutils/cmake/rcutilsConfig.cmake:41 (include)
  /opt/ros/humble/share/rosidl_runtime_c/cmake/ament_cmake_export_dependencies-extras.cmake:21 (find_package)
  ...
  CMakeLists.txt:10 (find_package)

Failed   <<< rob_box_perception_msgs [17.9s, exited with code 1]
```

### Context
- **Build Platform:** linux/amd64 (GitHub Actions runner)
- **Target Platform:** linux/arm64 (Raspberry Pi)
- **Build Method:** Docker BuildKit with QEMU emulation
- **Base Image:** `ghcr.io/krikz/rob_box:nav2-humble-latest` (contains pre-installed ROS packages)

## üîç –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

**–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** CMake config —Ñ–∞–π–ª—ã –≤ –±–∞–∑–æ–≤–æ–º –æ–±—Ä–∞–∑–µ –∏–º–µ—é—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—É—Ç–∏ –ø—Ä–∏ cross-compilation.

### –ü–æ—á–µ–º—É --reinstall –Ω–µ –ø–æ–º–æ–≥

–ü—Ä–µ–¥—ã–¥—É—â–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞:
```dockerfile
RUN apt-get update && apt-get install -y \
    ros-humble-rcutils \
    ... \
    && apt-get install -y --reinstall \
    ros-humble-rcutils \
    ...
```

**–ü—Ä–æ–±–ª–µ–º–∞ —Å —ç—Ç–∏–º –ø–æ–¥—Ö–æ–¥–æ–º:**
1. –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ (`nav2-humble-latest`) —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
2. –≠—Ç–∏ –ø–∞–∫–µ—Ç—ã –±—ã–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ –±–∞–∑–æ–≤–æ–º —Å–ª–æ–µ (parent layer) Docker
3. `apt-get install --reinstall` –≤ –¥–æ—á–µ—Ä–Ω–µ–º —Å–ª–æ–µ **–Ω–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—Ç** —Ñ–∞–π–ª—ã –∏–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å–ª–æ—è
4. CMake config —Ñ–∞–π–ª—ã –æ—Å—Ç–∞—é—Ç—Å—è —Å–æ —Å–ª–æ–º–∞–Ω–Ω—ã–º–∏ –ø—É—Ç—è–º–∏

### –°–ø–µ—Ü–∏—Ñ–∏–∫–∞ cross-compilation

–ü—Ä–∏ —Å–±–æ—Ä–∫–µ ARM64 –æ–±—Ä–∞–∑–∞ –Ω–∞ x86_64:
- Docker BuildKit –∏—Å–ø–æ–ª—å–∑—É–µ—Ç QEMU –¥–ª—è —ç–º—É–ª—è—Ü–∏–∏ ARM64
- –ü–∞–∫–µ—Ç—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ apt –∏–∑ ARM64 —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
- –ù–æ –µ—Å–ª–∏ –≤ –±–∞–∑–æ–≤–æ–º –æ–±—Ä–∞–∑–µ —É–∂–µ –µ—Å—Ç—å –ø–∞–∫–µ—Ç—ã, –∏—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π
- –û—Å–æ–±–µ–Ω–Ω–æ —ç—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è CMake config —Ñ–∞–π–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –ü–æ–¥—Ö–æ–¥: Explicit Remove + Install

```dockerfile
RUN apt-get update && \
    # –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª—è–µ–º –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –∏–∑ base image
    apt-get remove --purge -y \
    ros-${ROS_DISTRO}-builtin-interfaces \
    ros-${ROS_DISTRO}-rcutils \
    ros-${ROS_DISTRO}-rosidl-runtime-c \
    ros-${ROS_DISTRO}-rosidl-runtime-cpp \
    ros-${ROS_DISTRO}-rosidl-typesupport-c \
    ros-${ROS_DISTRO}-rosidl-typesupport-cpp \
    ros-${ROS_DISTRO}-rosidl-typesupport-fastrtps-c \
    ros-${ROS_DISTRO}-rosidl-typesupport-fastrtps-cpp 2>/dev/null || true && \
    # –¢–µ–ø–µ—Ä—å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å—ë –∑–∞–Ω–æ–≤–æ
    apt-get install -y \
    ros-dev-tools \
    ros-${ROS_DISTRO}-std-msgs \
    ... \
    ros-${ROS_DISTRO}-builtin-interfaces \
    ros-${ROS_DISTRO}-rcutils \
    ... \
    && rm -rf /var/lib/apt/lists/*
```

### –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **`apt-get remove --purge`** —É–¥–∞–ª—è–µ—Ç –ø–∞–∫–µ—Ç—ã –ò –∏—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
2. –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞—ë—Ç "whiteout" —Ñ–∞–π–ª—ã –≤ —Ç–µ–∫—É—â–µ–º Docker —Å–ª–æ–µ
3. –≠—Ç–∏ whiteout —Ñ–∞–π–ª—ã —Å–∫—Ä—ã–≤–∞—é—Ç —Ñ–∞–π–ª—ã –∏–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö —Å–ª–æ—ë–≤
4. **`apt-get install`** —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–∞–∫–µ—Ç—ã –∑–∞–Ω–æ–≤–æ —Å —á–∏—Å—Ç—ã–º–∏ config —Ñ–∞–π–ª–∞–º–∏
5. CMake config —Ñ–∞–π–ª—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—É—Ç—è–º–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–æ–¥—Ö–æ–¥–∞

- `2>/dev/null || true` - –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏ –µ—Å–ª–∏ –ø–∞–∫–µ—Ç—ã –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –í—Å–µ —É–¥–∞–ª—è–µ–º—ã–µ –ø–∞–∫–µ—Ç—ã —Å—Ä–∞–∑—É –∂–µ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –≤ —Ç–æ–π –∂–µ –∫–æ–º–∞–Ω–¥–µ
- apt –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

| –ü–æ–¥—Ö–æ–¥ | –†–∞–±–æ—Ç–∞–µ—Ç —Å parent layers? | –ü–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç config —Ñ–∞–π–ª—ã? | –ë–µ–∑–æ–ø–∞—Å–Ω–æ? |
|--------|---------------------------|---------------------------|------------|
| `apt-get install` | ‚ùå | ‚ùå | ‚úÖ |
| `apt-get install --reinstall` | ‚ùå | ‚ö†Ô∏è (—Ç–æ–ª—å–∫–æ –≤ —Ç–µ–∫—É—â–µ–º —Å–ª–æ–µ) | ‚úÖ |
| `apt-get remove + install` | ‚úÖ | ‚úÖ | ‚úÖ |

## üéØ –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –±—É–¥—É—â–µ–≥–æ

### ‚úÖ DO: –ü—Ä–∏ cross-compilation —Å –±–∞–∑–æ–≤—ã–º –æ–±—Ä–∞–∑–æ–º

1. –ï—Å–ª–∏ –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ —Å–æ–¥–µ—Ä–∂–∏—Ç ROS –ø–∞–∫–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `apt-get remove --purge + apt-get install` –≤ –æ–¥–Ω–æ–º RUN
3. –î–æ–±–∞–≤–ª—è–π—Ç–µ `2>/dev/null || true` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø–∞–∫–µ—Ç–æ–≤

### ‚ùå DON'T: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï —Ä–∞–±–æ—Ç–∞—é—Ç

1. ‚ùå `--reinstall` - –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–∞–π–ª—ã –∏–∑ parent layers
2. ‚ùå –†—É—á–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ CMake config —Ñ–∞–π–ª–æ–≤ - –Ω–µ —É–¥–∞–ª—è–µ—Ç library symlinks
3. ‚ùå `CMAKE_LIBRARY_PATH` –∞—Ä–≥—É–º–µ–Ω—Ç—ã - –ª–æ–º–∞—é—Ç –ø–æ–∏—Å–∫ –ø–∞–∫–µ—Ç–æ–≤
4. ‚ùå –ü—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É –∏ –Ω–∞–¥–µ—è—Ç—å—Å—è —á—Ç–æ "–º–æ–∂–µ—Ç –ø—Ä–æ–π–¥—ë—Ç"

### üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑

–ï—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ –±–µ–∑ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö ROS –ø–∞–∫–µ—Ç–æ–≤:
```dockerfile
FROM ghcr.io/krikz/rob_box_base:ros2-zenoh-humble-latest
# –í–º–µ—Å—Ç–æ:
# FROM ghcr.io/krikz/rob_box:nav2-humble-latest
```

–≠—Ç–æ –∏–∑–±–µ–∂–∏—Ç –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–º–∏ –ø–∞–∫–µ—Ç–∞–º–∏ –∏–∑ –±–∞–∑–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞.

## üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –§–∞–π–ª: `docker/vision/voice_assistant/Dockerfile`

**–°—Ç—Ä–æ–∫–∏ 49-87:** –ó–∞–º–µ–Ω—ë–Ω –ø–æ–¥—Ö–æ–¥ `--reinstall` –Ω–∞ `remove --purge + install`

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –£–¥–∞–ª–µ–Ω–æ 3 —Å—Ç—Ä–æ–∫–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –æ `--reinstall`
- –î–æ–±–∞–≤–ª–µ–Ω–æ 8 —Å—Ç—Ä–æ–∫ –¥–ª—è —è–≤–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –ø–∞–∫–µ—Ç–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ –ø—Ä–∏—á–∏–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- **GitHub Actions Run:** https://github.com/krikz/rob_box_project/actions/runs/18787411133
- **–ü—Ä–µ–¥—ã–¥—É—â–∞—è –ø–æ–ø—ã—Ç–∫–∞:** `docs/reports/VOICE_ASSISTANT_BUILD_FIX_2025-10-24.md`
- **–û–±—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `docs/development/DOCKER_BUILD_FIXES.md`

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ Commit –ø—Ä–∏–º–µ–Ω—ë–Ω
2. ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ CI/CD –ø—Ä–æ–≤–µ—Ä–∫–∏
3. üéØ –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ - –∑–∞–∫—Ä—ã—Ç—å issue
4. üìö –ï—Å–ª–∏ –Ω–µ —É—Å–ø–µ—à–Ω–æ - —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Å–º–µ–Ω—É –±–∞–∑–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞

---

**–ê–≤—Ç–æ—Ä –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** GitHub Copilot  
**–î–∞—Ç–∞:** 2025-10-24  
**–¢–∏–ø –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** Cross-compilation fix
**–ö–ª—é—á–µ–≤–æ–π —É—Ä–æ–∫:** `--reinstall` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ Docker layers - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ explicit remove+install!
