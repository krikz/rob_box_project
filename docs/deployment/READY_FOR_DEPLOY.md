# ‚úÖ –ì–æ—Ç–æ–≤–æ! Voice Assistant Optimization

## –ß—Ç–æ —Å–¥–µ–ª–∞–ª–∏

### 1. ‚úÖ –£–ø—Ä–æ—Å—Ç–∏–ª–∏ –ø—Ä–æ–º–ø—Ç DeepSeek
- **–ë—ã–ª–æ:** 21 KB —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ —É–¥–∞—Ä–µ–Ω–∏—è–º
- **–°—Ç–∞–ª–æ:** 3.7 KB –±–µ–∑ —É–¥–∞—Ä–µ–Ω–∏–π
- **–≠–∫–æ–Ω–æ–º–∏—è:** 82% –º–µ–Ω—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤

### 2. ‚úÖ –°–æ–∑–¥–∞–ª–∏ —Å–∏—Å—Ç–µ–º—É –∞–≤—Ç–æ—É–¥–∞—Ä–µ–Ω–∏–π
- **–°–ª–æ–≤–∞—Ä—å:** `accent_replacements.json` (25+ —Å–ª–æ–≤)
- **–ú–æ–¥—É–ª—å:** `accent_replacer.py`
- **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:** —Ç–æ–ø–æ–Ω–∏–º—ã, —Ç–µ—Ä–º–∏–Ω—ã, –≥–ª–∞–≥–æ–ª—ã, —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ

### 3. ‚úÖ –£–±—Ä–∞–ª–∏ –ø–æ–ª–µ `text` –∏–∑ JSON
- **–ë—ã–ª–æ:** `{"text": "...", "ssml": "..."}`  (510 –±–∞–π—Ç)
- **–°—Ç–∞–ª–æ:** `{"ssml": "..."}`  (321 –±–∞–π—Ç)
- **–≠–∫–æ–Ω–æ–º–∏—è:** 38% —Ç—Ä–∞—Ñ–∏–∫–∞

### 4. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–ª–∏ –≤ streaming —á–∞—Ç
- –û–±–Ω–æ–≤–ª—ë–Ω `robbox_chat_streaming.py`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —É–¥–∞—Ä–µ–Ω–∏–π –ø–µ—Ä–µ–¥ –æ–∑–≤—É—á–∏–≤–∞–Ω–∏–µ–º
- –£–ª—É—á—à–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ JSON

### 5. ‚úÖ Commit –∏ Push –≤ GitHub
- Feature branch: `feature/voice-assistant`
- Commit: `59540b6`
- 17 —Ñ–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ, 2917+ —Å—Ç—Ä–æ–∫

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ Docker (GitHub Actions)

GitHub Actions **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** —Å–æ–±–µ—Ä—ë—Ç –Ω–æ–≤—ã–π Docker –æ–±—Ä–∞–∑ –ø–æ—Å–ª–µ push!

**Workflow:** `.github/workflows/build-vision-services.yml`

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç:**
1. ‚úÖ GitHub Actions –æ–±–Ω–∞—Ä—É–∂–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `src/rob_box_voice/**`
2. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç job `build-voice-assistant`
3. ‚úÖ –°–æ–±–µ—Ä—ë—Ç Docker –æ–±—Ä–∞–∑ –¥–ª—è `linux/arm64`
4. ‚úÖ –û–ø—É–±–ª–∏–∫—É–µ—Ç –≤ `ghcr.io/krikz/rob_box:voice-assistant-humble-dev`

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:**
https://github.com/krikz/rob_box_project/actions

### –î–µ–ø–ª–æ–π –Ω–∞ —Ä–æ–±–æ—Ç–∞

–ö–æ–≥–¥–∞ GitHub Actions –∑–∞–∫–æ–Ω—á–∏—Ç (5-10 –º–∏–Ω—É—Ç):

```bash
# –ù–∞ Vision Pi (Raspberry Pi 5)
cd /home/ros2/rob_box_project/docker/vision

# –°–∫–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –æ–±—Ä–∞–∑
docker-compose pull voice-assistant

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose up -d voice-assistant

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker logs -f voice-assistant
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# ROS2 topics
ros2 topic list | grep voice

# –¢–µ—Å—Ç —ç—Ö–æ
ros2 topic echo /voice/dialogue/response

# –õ–æ–≥–∏ —Å —É–¥–∞—Ä–µ–Ω–∏—è–º–∏
docker logs voice-assistant | grep "üìñ –°–ª–æ–≤–∞—Ä—å —É–¥–∞—Ä–µ–Ω–∏–π"
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: "üìñ –°–ª–æ–≤–∞—Ä—å —É–¥–∞—Ä–µ–Ω–∏–π: 25 —Å–ª–æ–≤"
```

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–ª–æ–≤–∞—Ä—è —É–¥–∞—Ä–µ–Ω–∏–π

–ü—Ä–æ—Å—Ç–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π —Ñ–∞–π–ª –∏ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–π Docker:

```bash
# –ù–∞ dev –º–∞—à–∏–Ω–µ
vim src/rob_box_voice/config/accent_replacements.json

# –î–æ–±–∞–≤—å –Ω–æ–≤—ã–µ —Å–ª–æ–≤–∞
{
  "toponyms": {
    "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä": "–ö—Ä–∞—Å–Ω–æ–¥+–∞—Ä",
    "–ê–¥–ª–µ—Ä": "+–ê–¥–ª–µ—Ä",
    "–•–æ—Å—Ç–∞": "–•+–æ—Å—Ç–∞"
  }
}

# Commit –∏ push
git add src/rob_box_voice/config/accent_replacements.json
git commit -m "feat(voice): –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ç–æ–ø–æ–Ω–∏–º—ã –≤ —Å–ª–æ–≤–∞—Ä—å —É–¥–∞—Ä–µ–Ω–∏–π"
git push origin feature/voice-assistant

# GitHub Actions –ø–µ—Ä–µ—Å–æ–±–µ—Ä—ë—Ç –æ–±—Ä–∞–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ (–±–µ–∑ Docker)

```bash
cd src/rob_box_voice/scripts
set -a && source ../.env.secrets && set +a
python3 robbox_chat_streaming.py
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- "–ü—Ä–∏–≤–µ—Ç! –†–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ –°–æ—á–∏ –∫—Ä–∞—Ç–∫–æ"
- "–¢–µ–æ—Ä–µ–º–∞ –ü–∏—Ñ–∞–≥–æ—Ä–∞ —Å —Ñ–æ—Ä–º—É–ª–æ–π"
- "–ß—Ç–æ —Ç–∞–∫–æ–µ —Ä–æ–±–æ—Ç –†–û–ë–ë–û–ö–°?"

**–û–∂–∏–¥–∞–µ–º–æ–µ:**
- –£–¥–∞—Ä–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: –°+–æ—á–∏, –≥+–æ—Ä–æ–¥, —Ä+–æ–±–æ—Ç, —Ç–µ–æ—Ä+–µ–º–∞
- JSON –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π (–±–µ–∑ –ø–æ–ª—è text)
- –§–æ—Ä–º—É–ª—ã –ø—Ä–æ–ø–∏—Å—å—é (–∞ –≤ –∫–≤–∞–¥—Ä+–∞—Ç–µ –ø–ª—é—Å...)

### –í Docker (–Ω–∞ —Ä–æ–±–æ—Ç–µ)

```bash
# –í–æ–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker exec -it voice-assistant bash

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç
cd /ws
source install/setup.bash
python3 src/rob_box_voice/scripts/robbox_chat_streaming.py
```

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **VOICE_OPTIMIZATION_SUMMARY.md** - –ø–æ–ª–Ω–æ–µ —Ä–µ–∑—é–º–µ
- **SSML_ONLY_OPTIMIZATION.md** - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è SSML
- **src/rob_box_voice/docs/** - changelog, –ø—Ä–∞–≤–∏–ª–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## API –∫–ª—é—á–∏

**–í–∞–∂–Ω–æ:** –ù–∞ —Ä–æ–±–æ—Ç–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å API –∫–ª—é—á–∏ DeepSeek!

**–§–∞–π–ª:** `/home/ros2/rob_box_project/docker/vision/config/voice/secrets.yaml`

```yaml
deepseek:
  api_key: "sk-..."  # –í–∞—à –∫–ª—é—á
  base_url: "https://api.deepseek.com"
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
docker exec voice-assistant bash -c 'echo $DEEPSEEK_API_KEY'
```

–ï—Å–ª–∏ –ø—É—Å—Ç–æ - –¥–æ–±–∞–≤—å –≤ `docker-compose.yaml`:
```yaml
voice-assistant:
  environment:
    - DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY}
```

–ò —Å–æ–∑–¥–∞–π `.env` —Ñ–∞–π–ª:
```bash
cd /home/ros2/rob_box_project/docker/vision
echo "DEEPSEEK_API_KEY=sk-your-key-here" >> .env
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
```bash
docker logs -f voice-assistant
```

**–ß—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å:**
- `‚úÖ Silero TTS –∑–∞–≥—Ä—É–∂–µ–Ω`
- `üìñ –°–ª–æ–≤–∞—Ä—å —É–¥–∞—Ä–µ–Ω–∏–π: 25 —Å–ª–æ–≤`
- `‚úì Zenoh router –¥–æ—Å—Ç—É–ø–µ–Ω`
- `üîä –ì–æ–≤–æ—Ä—é: –°+–æ—á–∏...` (–≤–∏–¥–Ω–æ —É–¥–∞—Ä–µ–Ω–∏—è)

### ROS2 —Ç–æ–ø–∏–∫–∏
```bash
# –°–ø–∏—Å–æ–∫ —Ç–æ–ø–∏–∫–æ–≤
ros2 topic list

# –≠—Ö–æ –æ—Ç–≤–µ—Ç–æ–≤
ros2 topic echo /voice/dialogue/response

# –≠—Ö–æ —Ä–µ—á–∏
ros2 topic echo /voice/audio/speech
```

### Zenoh –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
# Zenoh endpoints
curl http://localhost:8000/@/local/router

# Zenoh sessions
curl http://localhost:8000/@/session/*/sub/*
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–î–æ:**
- System prompt: 21 KB
- JSON chunk: 510 –±–∞–π—Ç
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∫–∞—á–µ—Å—Ç–≤–∞ LLM

**–ü–æ—Å–ª–µ:**
- System prompt: 3.7 KB (**82% ‚Üì**)
- JSON chunk: 321 –±–∞–π—Ç (**38% ‚Üì**)
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–µ —É–¥–∞—Ä–µ–Ω–∏—è
- –ë—ã—Å—Ç—Ä–µ–µ –ø–µ—Ä–≤—ã–π –æ—Ç–≤–µ—Ç

**–¢–µ—Å—Ç—ã –ø–æ–∫–∞–∑–∞–ª–∏:**
- ‚úÖ –°–æ—á–∏: 3 chunks, –≤—Å–µ —É–¥–∞—Ä–µ–Ω–∏—è –Ω–∞ –º–µ—Å—Ç–µ
- ‚úÖ –ü–∏—Ñ–∞–≥–æ—Ä: 2 chunks, —Ñ–æ—Ä–º—É–ª—ã –ø—Ä–æ–ø–∏—Å—å—é
- ‚úÖ –ü—Ä–∏–≤–µ—Ç: 1 chunk, –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–°–ª–æ–≤–∞—Ä—å:** 25 —Å–ª–æ–≤ (–ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è)
2. **–û–º–æ–≥—Ä–∞—Ñ—ã:** –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã (–∑–∞–º–æ–∫/–∑–∞–º–æ–∫)
3. **DeepSeek:** –ò–Ω–æ–≥–¥–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç JSON (–ø–∞—Ä—Å–µ—Ä —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è)

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä—å –ª–æ–≥–∏** –ø–µ—Ä–≤—É—é –Ω–µ–¥–µ–ª—é
2. ‚úÖ **–†–∞—Å—à–∏—Ä—è–π —Å–ª–æ–≤–∞—Ä—å** –ø–æ –º–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
3. ‚úÖ **–î–æ–±–∞–≤–ª—è–π –æ–º–æ–≥—Ä–∞—Ñ—ã** –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
4. ‚úÖ **–¢–µ—Å—Ç–∏—Ä—É–π** –Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–ª–æ–≤

---

## –ò—Ç–æ–≥–∏

‚úÖ **–£–ø—Ä–æ—â—ë–Ω –ø—Ä–æ–º–ø—Ç** (82% –º–µ–Ω—å—à–µ)  
‚úÖ **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω JSON** (38% –º–µ–Ω—å—à–µ)  
‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω—ã –∞–≤—Ç–æ—É–¥–∞—Ä–µ–Ω–∏—è** (—Å–ª–æ–≤–∞—Ä—å 25+ —Å–ª–æ–≤)  
‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ streaming —á–∞—Ç**  
‚úÖ **Commit –∏ push –≤ GitHub**  
‚úÖ **GitHub Actions —Å–æ–±–µ—Ä—ë—Ç Docker –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**  
‚è≥ **–ñ–¥—ë–º —Å–±–æ—Ä–∫—É** (5-10 –º–∏–Ω—É—Ç)  
‚è≥ **–î–µ–ø–ª–æ–π –Ω–∞ —Ä–æ–±–æ—Ç–∞** (docker-compose pull + up)  

**–°—Ç–∞—Ç—É—Å:** üöÄ **Ready for production!**
