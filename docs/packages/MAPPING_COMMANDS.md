# –ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏–µ–π –†–û–ë–ë–û–ö–°

## üìã –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–º SLAM –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —á–µ—Ä–µ–∑ RTABMap. –†–æ–±–æ—Ç –º–æ–∂–µ—Ç –Ω–∞—á–∏–Ω–∞—Ç—å –Ω–æ–≤–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏, –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–∞—Ä—Ç—É –∏–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –≤ —Ä–µ–∂–∏–º –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.

## üéØ –ö–æ–º–∞–Ω–¥—ã

### 1. "–ò—Å—Å–ª–µ–¥—É–π —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é" (Start Mapping)

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ù–∞—á–∞—Ç—å –Ω–æ–≤–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏, —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É

**Workflow**:
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ò—Å—Å–ª–µ–¥—É–π —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é"
2. –†–æ–±–æ—Ç: "–ù–∞—á–∞—Ç—å –Ω–æ–≤–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ? –°—Ç–∞—Ä–∞—è –∫–∞—Ä—Ç–∞ –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é."
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–î–∞" / "–ù–∞—á–∏–Ω–∞–π"
4. –†–æ–±–æ—Ç:
   - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å rtabmap –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é –ë–î: mv rtabmap.db ‚Üí rtabmap_backup_<timestamp>.db
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å rtabmap —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º --delete_db_on_start
   - –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å: "–ù–∞—á–∏–Ω–∞—é –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ. –°—Ç–∞—Ä–∞—è –∫–∞—Ä—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞."
```

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏**:
- **–†–µ–∂–∏–º**: SLAM (Mapping)
- **–ü–∞—Ä–∞–º–µ—Ç—Ä**: `Mem/IncrementalMemory: true` (–≤–∫–ª—é—á–µ–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: –°–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–∞—è `/maps/rtabmap.db`
- **Backup**: `/maps/backups/rtabmap_backup_YYYY-MM-DD_HH-MM-SS.db`

**ROS2 —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
```bash
# –°–±—Ä–æ—Å –ë–î –∏ –ø–µ—Ä–µ—Ö–æ–¥ –≤ SLAM mode
ros2 service call /rtabmap/reset_memory std_srvs/srv/Empty

# –ò–õ–ò —á–µ—Ä–µ–∑ Docker restart —Å --delete_db_on_start
docker stop rtabmap
mv /path/to/maps/rtabmap.db /path/to/maps/backups/rtabmap_backup_$(date +%Y-%m-%d_%H-%M-%S).db
docker start rtabmap  # —Å --delete_db_on_start –≤ args
```

---

### 2. "–ü—Ä–æ–¥–æ–ª–∂–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ" (Continue Mapping)

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—é, –æ—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–∞—Ä—Ç–æ–π

**Workflow**:
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ü—Ä–æ–¥–æ–ª–∂–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ"
2. –†–æ–±–æ—Ç: "–ü—Ä–æ–¥–æ–ª–∂–∞—é –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏. –î–æ–±–∞–≤–ª—è—é –Ω–æ–≤—ã–µ –æ–±–ª–∞—Å—Ç–∏ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–∞—Ä—Ç–µ."
3. –†–æ–±–æ—Ç:
   - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ rtabmap –≤ SLAM mode
   - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ Mem/IncrementalMemory: true
   - –ù–µ —É–¥–∞–ª—è—Ç—å –ë–î –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (–±–µ–∑ --delete_db_on_start)
```

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏**:
- **–†–µ–∂–∏–º**: SLAM (Mapping) - –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ
- **–ü–∞—Ä–∞–º–µ—Ç—Ä**: `Mem/IncrementalMemory: true`
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è `/maps/rtabmap.db`
- **–°–µ—Å—Å–∏—è**: RTABMap –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ

**ROS2 –∫–æ–º–∞–Ω–¥—ã**:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∂–∏–º–∞
ros2 param get /rtabmap/rtabmap Mem/IncrementalMemory
# Output: Boolean value is: true

# –ï—Å–ª–∏ –≤ localization mode - –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤ mapping
ros2 service call /rtabmap/set_mode_mapping std_srvs/srv/Empty
```

---

### 3. "–ó–∞–∫–æ–Ω—á–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ" (Finish Mapping ‚Üí Localization)

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ó–∞–∫–æ–Ω—á–∏—Ç—å –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—é, –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –≤ —Ä–µ–∂–∏–º –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

**Workflow**:
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ó–∞–∫–æ–Ω—á–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ"
2. –†–æ–±–æ—Ç: "–ó–∞–∫–∞–Ω—á–∏–≤–∞—é –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ. –ü–µ—Ä–µ–∫–ª—é—á–∞—é—Å—å –≤ —Ä–µ–∂–∏–º –Ω–∞–≤–∏–≥–∞—Ü–∏–∏."
3. –†–æ–±–æ—Ç:
   - –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å RTABMap –≤ Localization mode
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é –ë–î (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
   - Mem/IncrementalMemory: false
   - –†–æ–±–æ—Ç –±—É–¥–µ—Ç –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–∞—Ä—Ç–µ
```

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏**:
- **–†–µ–∂–∏–º**: Localization (—Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è, –∫–∞—Ä—Ç–∞ –ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)
- **–ü–∞—Ä–∞–º–µ—Ç—Ä**: `Mem/IncrementalMemory: false`
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: `/maps/rtabmap.db` (read-only –¥–ª—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏)
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –î–ª—è –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –≥–æ—Ç–æ–≤–æ–π –∫–∞—Ä—Ç–µ

**ROS2 —Å–µ—Ä–≤–∏—Å—ã**:
```bash
# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤ Localization mode
ros2 service call /rtabmap/set_mode_localization std_srvs/srv/Empty

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∂–∏–º–∞
ros2 param get /rtabmap/rtabmap Mem/IncrementalMemory
# Output: Boolean value is: false (localization mode)

# –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ Mapping mode
ros2 service call /rtabmap/set_mode_mapping std_srvs/srv/Empty
```

---

## üîß RTABMap —Ä–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

### SLAM Mode (Mapping)
```yaml
Mem/IncrementalMemory: true
```
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã
- **–ü–æ–≤–µ–¥–µ–Ω–∏–µ**: 
  - –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ —É–∑–ª—ã (nodes) –≤ –≥—Ä–∞—Ñ –∫–∞—Ä—Ç—ã
  - –í—ã–ø–æ–ª–Ω—è–µ—Ç loop closure detection
  - –û–±–Ω–æ–≤–ª—è–µ—Ç –∫–∞—Ä—Ç—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
  - –°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–µ landmarks
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: Read-Write

### Localization Mode
```yaml
Mem/IncrementalMemory: false
```
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –≥–æ—Ç–æ–≤–æ–π –∫–∞—Ä—Ç–µ
- **–ü–æ–≤–µ–¥–µ–Ω–∏–µ**:
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–∞—Ä—Ç—É
  - –ù–ï –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ —É–∑–ª—ã
  - –¢–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–∑–∏—Ü–∏—é —Ä–æ–±–æ—Ç–∞
  - –ë—ã—Å—Ç—Ä–µ–µ —á–µ–º SLAM mode
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: Read-Only (–¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏)

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```
/maps/
‚îú‚îÄ‚îÄ rtabmap.db              # –¢–µ–∫—É—â–∞—è –∞–∫—Ç–∏–≤–Ω–∞—è –ë–î
‚îî‚îÄ‚îÄ backups/
    ‚îú‚îÄ‚îÄ rtabmap_backup_2025-10-18_10-30-00.db
    ‚îú‚îÄ‚îÄ rtabmap_backup_2025-10-18_14-20-15.db
    ‚îî‚îÄ‚îÄ ...
```

---

## ü§ñ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Dialogue Node

### –î–æ–±–∞–≤–∏—Ç—å Intent Patterns:

```python
# –í dialogue_node.py

MAPPING_INTENTS = {
    'start_mapping': [
        r'–∏—Å—Å–ª–µ–¥—É–π —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é',
        r'–Ω–∞—á–Ω–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ',
        r'—Å–æ–∑–¥–∞–π –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É',
        r'–Ω–∞—á–Ω–∏ –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—é',
        r'–Ω–æ–≤–∞—è –∫–∞—Ä—Ç–∞',
    ],
    'continue_mapping': [
        r'–ø—Ä–æ–¥–æ–ª–∂–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ',
        r'–ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—é',
        r'–ø—Ä–æ–¥–æ–ª–∂–∞–π –∫–∞—Ä—Ç—É',
        r'–¥–æ–±–∞–≤—å –∫ –∫–∞—Ä—Ç–µ',
    ],
    'finish_mapping': [
        r'–∑–∞–∫–æ–Ω—á–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ',
        r'–∑–∞–≤–µ—Ä—à–∏—Ç—å –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—é',
        r'–ø–µ—Ä–µ–π–¥–∏ –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏—é',
        r'—Ä–µ–∂–∏–º –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏',
        r'–∫–∞—Ä—Ç–∞ –≥–æ—Ç–æ–≤–∞',
    ],
}
```

### –î–æ–±–∞–≤–∏—Ç—å ROS2 Service Publishers:

```python
from std_srvs.srv import Empty
from example_interfaces.srv import SetBool

class DialogueNode(Node):
    def __init__(self):
        super().__init__('dialogue_node')
        
        # RTABMap control services
        self.reset_memory_client = self.create_client(Empty, '/rtabmap/reset_memory')
        self.set_mode_mapping_client = self.create_client(Empty, '/rtabmap/set_mode_mapping')
        self.set_mode_localization_client = self.create_client(Empty, '/rtabmap/set_mode_localization')
        
        # –î–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
        self.pending_confirmation = None
```

### Handler –¥–ª—è –∫–æ–º–∞–Ω–¥:

```python
async def handle_mapping_command(self, intent, text):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏–∏"""
    
    if intent == 'start_mapping':
        # –ó–∞–ø—Ä–æ—Å–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
        self.pending_confirmation = 'start_mapping'
        return "–ù–∞—á–∞—Ç—å –Ω–æ–≤–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ? –°—Ç–∞—Ä–∞—è –∫–∞—Ä—Ç–∞ –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é."
    
    elif intent == 'continue_mapping':
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∂–∏–º
        is_mapping = await self.check_mapping_mode()
        if not is_mapping:
            await self.call_service(self.set_mode_mapping_client)
            return "–ü—Ä–æ–¥–æ–ª–∂–∞—é –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏. –î–æ–±–∞–≤–ª—è—é –Ω–æ–≤—ã–µ –æ–±–ª–∞—Å—Ç–∏ –∫ –∫–∞—Ä—Ç–µ."
        else:
            return "–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —É–∂–µ –∞–∫—Ç–∏–≤–Ω–æ. –ü—Ä–æ–¥–æ–ª–∂–∞—é –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—é."
    
    elif intent == 'finish_mapping':
        # –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤ localization
        await self.call_service(self.set_mode_localization_client)
        return "–ó–∞–∫–∞–Ω—á–∏–≤–∞—é –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ. –ü–µ—Ä–µ–∫–ª—é—á–∞—é—Å—å –≤ —Ä–µ–∂–∏–º –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –∫–∞—Ä—Ç–µ."
```

---

## üîÑ Workflow –¥–ª—è backup

### Docker volume backup script:

```bash
#!/bin/bash
# /maps/backup_rtabmap.sh

BACKUP_DIR="/maps/backups"
mkdir -p "$BACKUP_DIR"

TIMESTAMP=$(date +%Y-%m-%d_%H-%M-%S)
DB_FILE="/maps/rtabmap.db"

if [ -f "$DB_FILE" ]; then
    cp "$DB_FILE" "$BACKUP_DIR/rtabmap_backup_${TIMESTAMP}.db"
    echo "‚úÖ Backup created: rtabmap_backup_${TIMESTAMP}.db"
    
    # –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ backup (—Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π)
    find "$BACKUP_DIR" -name "rtabmap_backup_*.db" -mtime +30 -delete
    echo "‚úÖ Old backups cleaned"
else
    echo "‚ùå Database file not found: $DB_FILE"
    exit 1
fi
```

### –í—ã–∑–æ–≤ –∏–∑ Python:

```python
import subprocess
from datetime import datetime

async def backup_rtabmap_db(self):
    """–°–æ–∑–¥–∞—Ç—å backup —Ç–µ–∫—É—â–µ–π –ë–î RTABMap"""
    try:
        # –ß–µ—Ä–µ–∑ Docker exec
        result = subprocess.run([
            'docker', 'exec', 'rtabmap',
            'bash', '-c',
            '/maps/backup_rtabmap.sh'
        ], capture_output=True, text=True, check=True)
        
        self.get_logger().info(f"‚úÖ RTABMap backup: {result.stdout}")
        return True
    except subprocess.CalledProcessError as e:
        self.get_logger().error(f"‚ùå Backup failed: {e.stderr}")
        return False
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ RTABMap —Å–µ—Ä–≤–∏—Å–æ–≤:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
ros2 service list | grep rtabmap

# –û–∂–∏–¥–∞–µ–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã:
# /rtabmap/reset_memory
# /rtabmap/set_mode_mapping
# /rtabmap/set_mode_localization
# /rtabmap/pause
# /rtabmap/resume

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º
ros2 param get /rtabmap/rtabmap Mem/IncrementalMemory

# 3. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ –≤—Ä—É—á–Ω—É—é
ros2 service call /rtabmap/set_mode_localization std_srvs/srv/Empty
ros2 service call /rtabmap/set_mode_mapping std_srvs/srv/Empty

# 4. –°–±—Ä–æ—Å –ø–∞–º—è—Ç–∏ (–Ω–æ–≤–∞—è –∫–∞—Ä—Ç–∞)
ros2 service call /rtabmap/reset_memory std_srvs/srv/Empty
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

```bash
# –†–∞–∑–º–µ—Ä –ë–î
docker exec rtabmap ls -lh /maps/rtabmap.db

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ nodes –≤ –ë–î
docker exec rtabmap bash -c "sqlite3 /maps/rtabmap.db 'SELECT COUNT(*) FROM Node;'"

# –ü–æ—Å–ª–µ–¥–Ω—è—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è
docker exec rtabmap stat /maps/rtabmap.db
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ–∂–∏–º–∞

### –¢–æ–ø–∏–∫ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ RTABMap:

```bash
# –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
ros2 topic echo /rtabmap/info --once

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∂–∏–º (Mem/IncrementalMemory –≤ stats)
ros2 topic echo /rtabmap/info | grep -A5 "Mem/IncrementalMemory"
```

### –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤ Reflection Node:

```python
# –í reflection_node.py - –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ /rtabmap/info

class ReflectionNode(Node):
    def __init__(self):
        super().__init__('reflection_node')
        
        self.rtabmap_info_sub = self.create_subscription(
            String,  # –∏–ª–∏ rtabmap_msgs.msg.Info
            '/rtabmap/info',
            self.rtabmap_info_callback,
            10
        )
        
        self.current_mapping_mode = None  # 'mapping' or 'localization'
    
    def rtabmap_info_callback(self, msg):
        """–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–µ–∂–∏–º–∞ RTABMap –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞"""
        # –ü–∞—Ä—Å–∏—Ç—å info –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–µ–∂–∏–º
        # –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ self.current_mapping_mode
        # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ generate_thought() –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        pass
```

---

## üöÄ –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: RTABMap Services (–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ rtabmap –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ –≤—Ä—É—á–Ω—É—é
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ reset_memory —Ä–∞–±–æ—Ç–∞–µ—Ç

### –≠—Ç–∞–ø 2: Backup —Å–∏—Å—Ç–µ–º–∞
- [ ] –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç backup_rtabmap.sh
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ Docker volume: `./scripts/rtabmap:/scripts:ro`
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å backup —á–µ—Ä–µ–∑ Docker exec

### –≠—Ç–∞–ø 3: Dialogue Node integration
- [ ] –î–æ–±–∞–≤–∏—Ç—å intent patterns –¥–ª—è 3 –∫–æ–º–∞–Ω–¥
- [ ] –°–æ–∑–¥–∞—Ç—å ROS2 service clients
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å handler –¥–ª—è mapping commands
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–¥–ª—è start_mapping)

### –≠—Ç–∞–ø 4: Reflection Node awareness
- [ ] –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ /rtabmap/info
- [ ] –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏

### –≠—Ç–∞–ø 5: Testing
- [ ] –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ backup/restore
- [ ] –ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã end-to-end
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ò—Å—Å–ª–µ–¥—É–π —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é"
–†–æ–±–æ—Ç: "–ù–∞—á–∞—Ç—å –Ω–æ–≤–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ? –°—Ç–∞—Ä–∞—è –∫–∞—Ä—Ç–∞ –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é."
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–î–∞"
–†–æ–±–æ—Ç: "–ù–∞—á–∏–Ω–∞—é –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ. –°—Ç–∞—Ä–∞—è –∫–∞—Ä—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞."
[–†–æ–±–æ—Ç –¥–≤–∏–∂–µ—Ç—Å—è, —Å–æ–∑–¥–∞—ë—Ç –∫–∞—Ä—Ç—É]
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ü—Ä–æ–¥–æ–ª–∂–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ"
–†–æ–±–æ—Ç: "–ü—Ä–æ–¥–æ–ª–∂–∞—é –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏. –î–æ–±–∞–≤–ª—è—é –Ω–æ–≤—ã–µ –æ–±–ª–∞—Å—Ç–∏ –∫ –∫–∞—Ä—Ç–µ."
[RTABMap —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ë–î]
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–µ—Ä–µ—Ö–æ–¥ –∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ó–∞–∫–æ–Ω—á–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ"
–†–æ–±–æ—Ç: "–ó–∞–∫–∞–Ω—á–∏–≤–∞—é –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ. –ü–µ—Ä–µ–∫–ª—é—á–∞—é—Å—å –≤ —Ä–µ–∂–∏–º –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –∫–∞—Ä—Ç–µ."
[RTABMap –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ localization mode]
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ü–æ–µ–∑–∂–∞–π –∫ –∑–∞—Ä—è–¥–Ω–æ–π —Å—Ç–∞–Ω—Ü–∏–∏"
–†–æ–±–æ—Ç: "–°—Ç—Ä–æ—é –º–∞—Ä—à—Ä—É—Ç –∫ –∑–∞—Ä—è–¥–Ω–æ–π —Å—Ç–∞–Ω—Ü–∏–∏."
[Nav2 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–æ—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏]
```

---

## üîó –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [RTABMap ROS2 Wiki](http://wiki.ros.org/rtabmap_ros)
- [RTABMap Services Documentation](http://wiki.ros.org/rtabmap_ros#Services)
- [RTABMap Database Format](https://github.com/introlab/rtabmap/wiki/Database-structure)
- [–ü—Ä–æ–µ–∫—Ç: docker/main/docker-compose.yaml](../docker/main/docker-compose.yaml)
- [–ü—Ä–æ–µ–∫—Ç: docker/main/config/rtabmap/rtabmap.yaml](../docker/main/config/rtabmap/rtabmap.yaml)

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –í—Å–µ–≥–¥–∞ –¥–µ–ª–∞—Ç—å backup –ø–µ—Ä–µ–¥ `reset_memory`
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: Localization mode –±—ã—Å—Ç—Ä–µ–µ SLAM mode
3. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: –ü—Ä–∏ –±–æ–ª—å—à–∏—Ö –∫–∞—Ä—Ç–∞—Ö –ë–î –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å >1GB
4. **Backup retention**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—Ç—å backup —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
5. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–ª—è `start_mapping`

---

**–°—Ç–∞—Ç—É—Å**: üìã –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –°–†–ï–î–ù–ò–ô (–ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è sound effects)  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: –°–†–ï–î–ù–Ø–Ø (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å RTABMap services)
