<?xml version="1.0"?>
<!-- 
  rob_box_ros2_control.xacro
  
  ros2_control интеграция с VESC Nexus hardware interface
  Определяет 4 колеса с VESC моторами через CAN
-->
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!-- ═══════════════════════════════════════════════════════════════ -->
  <!-- ros2_control Hardware Interface - VESC Nexus                    -->
  <!-- ═══════════════════════════════════════════════════════════════ -->
  
  <ros2_control name="VescSystem" type="system">
    <hardware>
      <plugin>vesc_nexus/VescSystemHardwareInterface</plugin>
      
      <!-- CAN Interface Configuration -->
      <param name="can_interface">can0</param>
      <param name="publish_rate">50.0</param>
      
      <!-- Default wheel radius (может быть переопределен для каждого колеса) -->
      <param name="wheel_radius">0.115</param>
    </hardware>

    <!-- ═══════════════════════════════════════════════════════════════ -->
    <!-- Left Front Wheel -->
    <!-- ═══════════════════════════════════════════════════════════════ -->
    <joint name="left_front_wheel_joint">
      <command_interface name="velocity">
        <param name="min">-10</param>  <!-- м/с -->
        <param name="max">10</param>
      </command_interface>
      <state_interface name="velocity"/>
      <state_interface name="position"/>
      
      <!-- VESC Configuration -->
      <param name="can_id">49</param>              <!-- CAN ID в VESC Tool -->
      <param name="poles">30</param>               <!-- Количество полюсов мотора -->
      <param name="min_erpm">100</param>           <!-- Минимальный ERPM для движения -->
      <param name="wheel_radius">0.115</param>     <!-- Радиус колеса (м) -->
    </joint>

    <!-- ═══════════════════════════════════════════════════════════════ -->
    <!-- Right Front Wheel -->
    <!-- ═══════════════════════════════════════════════════════════════ -->
    <joint name="right_front_wheel_joint">
      <command_interface name="velocity">
        <param name="min">-10</param>
        <param name="max">10</param>
      </command_interface>
      <state_interface name="velocity"/>
      <state_interface name="position"/>
      
      <param name="can_id">124</param>
      <param name="poles">30</param>
      <param name="min_erpm">100</param>
      <param name="wheel_radius">0.115</param>
    </joint>

    <!-- ═══════════════════════════════════════════════════════════════ -->
    <!-- Left Rear Wheel -->
    <!-- ═══════════════════════════════════════════════════════════════ -->
    <joint name="left_rear_wheel_joint">
      <command_interface name="velocity">
        <param name="min">-10</param>
        <param name="max">10</param>
      </command_interface>
      <state_interface name="velocity"/>
      <state_interface name="position"/>
      
      <param name="can_id">81</param>
      <param name="poles">30</param>
      <param name="min_erpm">100</param>
      <param name="wheel_radius">0.115</param>
    </joint>

    <!-- ═══════════════════════════════════════════════════════════════ -->
    <!-- Right Rear Wheel -->
    <!-- ═══════════════════════════════════════════════════════════════ -->
    <joint name="right_rear_wheel_joint">
      <command_interface name="velocity">
        <param name="min">-10</param>
        <param name="max">10</param>
      </command_interface>
      <state_interface name="velocity"/>
      <state_interface name="position"/>
      
      <param name="can_id">94</param>
      <param name="poles">30</param>
      <param name="min_erpm">100</param>
      <param name="wheel_radius">0.115</param>
    </joint>
  </ros2_control>

</robot>
