# TTS Voice Testing Script

Интерактивный скрипт для тестирования и подбора голосов Text-to-Speech на русском языке.

## Возможности

- **Скачивание моделей** - автоматически скачивает все доступные русские модели TTS
- **Интерактивное тестирование** - прослушивание голосов с разными настройками
- **3 TTS движка:**
  - **Piper** (рекомендуется) - neural TTS, быстрый, качественный
  - **Silero** - 4 голоса, хорошее качество, медленнее
  - **RHVoice** - легковесный, но звучит роботизированно

## Установка зависимостей

### Piper (рекомендуется)

```bash
pip install piper-tts
```

### Silero

```bash
pip install torch torchaudio omegaconf
```

### RHVoice

```bash
sudo apt-get install rhvoice rhvoice-russian
```

## Использование

### Интерактивный режим (все движки)

```bash
python3 test_tts_voices.py
```

Скрипт предложит выбрать TTS движок, затем:
1. Выберите голос из списка (1-4)
2. Прослушайте синтезированную речь
3. Смените фразу (`p`) или скорость (`s`)
4. Тестируйте разные голоса

### Конкретный движок

```bash
# Только Piper
python3 test_tts_voices.py --engine piper

# Только Silero
python3 test_tts_voices.py --engine silero

# Только RHVoice
python3 test_tts_voices.py --engine rhvoice
```

### Кастомная директория для моделей

```bash
python3 test_tts_voices.py --models-dir /path/to/models
```

По умолчанию модели сохраняются в `~/.cache/rob_box_voice/tts_models/`

## Доступные голоса

### Piper (2 голоса)

| Голос | Пол | Размер | Описание |
|-------|-----|--------|----------|
| **dmitri** | M | 63 MB | Чёткий, спокойный (рекомендуется для робота) |
| **irina** | F | 63 MB | Тёплый, дружелюбный |

### Silero (4 голоса)

| Голос | Пол | Размер | Скорость на CPU | Описание |
|-------|-----|--------|-----------------|----------|
| **aidar** | M | ~100 MB | **2-3x realtime** (1 поток) | Нейтральный |
| **baya** | F | ~100 MB | **2-3x realtime** (1 поток) | Тёплый |
| **kseniya** | F | ~100 MB | **2-3x realtime** (1 поток) | Энергичный |
| **xenia** | F | ~100 MB | **2-3x realtime** (1 поток) | Молодой, дружелюбный |

**⚡ Производительность на Raspberry Pi 5:**
- **RTF = 0.3-0.5** (1 поток, 16kHz) → **2-3x быстрее realtime**
- **RTF = 0.2-0.3** (4 потока, 16kHz) → **3-5x быстрее realtime**
- Работает на CPU без GPU
- Зависимости: PyTorch (~300 MB), но оптимизирован для ARM

### RHVoice (4 голоса)

| Голос | Пол | Описание |
|-------|-----|----------|
| aleksandr | M | Классический |
| anna | F | Нейтральный |
| elena | F | Приятный |
| irina | F | Тёплый |

**Примечание:** RHVoice использует формантный синтез и звучит роботизированно (не рекомендуется).

## Тестовые фразы

Скрипт использует следующие фразы для тестирования:

1. "Привет! Я голосовой ассистент робота Роббокс."
2. "Еду вперёд. Скорость полметра в секунду."
3. "Заряд батареи семьдесят восемь процентов."
4. "Обнаружено препятствие на расстоянии один метр."
5. "Поворачиваю налево на девяносто градусов."
6. "Система навигации готова. Ожидаю команды."

Смена фразы: нажмите `p` в меню.

## Настройка скорости

Скорость синтеза можно изменить в меню (`s`):
- Диапазон: 0.5-2.0
- По умолчанию: 1.0
- Для робота рекомендуется: 0.8-1.2

## Примеры

### Быстрое тестирование Piper dmitri

```bash
python3 test_tts_voices.py --engine piper
# Выбрать: 1 (dmitri)
# Прослушать
# Изменить скорость: s -> 0.9
# Прослушать снова
```

### Сравнение всех голосов Silero

```bash
python3 test_tts_voices.py --engine silero
# Тестируем все 4 голоса по очереди
# Выбираем лучший для робота
```

## Рекомендация для ROBBOX

### Вариант 1: Piper (рекомендуется для продакшна)

**Выбор:** Piper - dmitri, скорость 1.0

**Причины:**
- ✅ Качественный neural TTS
- ✅ Чёткая дикция (важно для команд)
- ✅ Спокойный тон (подходит роботу)
- ✅ Быстрый синтез (<0.5s)
- ✅ Малый размер (63 MB)
- ✅ Минимум зависимостей

### Вариант 2: Silero (отличная альтернатива!)

**Выбор:** Silero - aidar или baya

**Причины:**
- ✅ **Работает на Raspberry Pi 5!** (проверено на ARM)
- ✅ **Быстрее realtime** (RTF 0.3-0.5 на 1 потоке CPU)
- ✅ Высокое качество звука
- ✅ 4 голоса на выбор
- ⚠️ PyTorch зависимость (~300 MB)
- ⚠️ Модель ~100 MB (vs 63 MB у Piper)

**Сравнение производительности:**

| Параметр | Piper | Silero |
|----------|-------|--------|
| Размер модели | 63 MB | ~100 MB |
| Зависимости | ~10 MB | ~300 MB (PyTorch) |
| **Скорость (1 поток)** | ~0.5s/фразу | **0.3-0.5s/фразу** |
| **Скорость (4 потока)** | ~0.5s/фразу | **0.2-0.3s/фразу** |
| Качество | Отличное | Отличное |
| Голосов | 2 | 4 |

**Вывод:** Оба варианта отлично работают на Raspberry Pi 5! Silero чуть быстрее при большем размере.

## Интеграция в rob_box_voice

После выбора голоса обновите конфигурацию:

```yaml
# config/voice_assistant.yaml
tts_node:
  provider: "piper"
  piper:
    model_path: "/models/ru_RU-dmitri-medium.onnx"
    voice_speed: 1.0  # Или выбранная скорость
```

## Troubleshooting

### Ошибка "ModuleNotFoundError: No module named 'piper'"

```bash
pip install piper-tts
```

### Ошибка "ModuleNotFoundError: No module named 'torch'"

```bash
pip install torch torchaudio
```

### Ошибка "RHVoice-test: command not found"

```bash
sudo apt-get install rhvoice rhvoice-russian
```

### Модели не скачиваются (wget ошибка)

```bash
# Проверьте интернет-соединение
ping github.com

# Или скачайте вручную и поместите в ~/.cache/rob_box_voice/tts_models/
```

### Нет звука при воспроизведении

```bash
# Проверьте ALSA
aplay -l

# Проверьте что устройство не занято
lsof /dev/snd/*

# Проверьте громкость
alsamixer
```

## Размер кэша

После скачивания всех моделей:

| Движок | Размер | RAM при работе |
|--------|--------|----------------|
| **Piper (2 голоса)** | ~126 MB | ~50-100 MB |
| **Silero (модель + 4 голоса)** | ~400 MB | ~150-250 MB |
| RHVoice | ~50 MB (установка через apt) | ~20-50 MB |

**Итого:** ~576 MB для всех движков

**Рекомендации по выбору:**

1. **Для продакшна с ограниченной памятью:**
   - Скачать только **Piper** (~126 MB диск, ~50 MB RAM)
   - Простой, быстрый, надёжный

2. **Для лучшего качества и производительности:**
   - Скачать **Silero** (~400 MB диск, ~200 MB RAM)
   - Быстрее realtime даже на 1 потоке
   - 4 голоса на выбор
   - Отлично работает на Raspberry Pi 5

3. **Для экспериментов:**
   - Скачать всё (~576 MB) и сравнить

**Память на Raspberry Pi 5 (8GB):**
- ROS2 + Navigation: ~2-3 GB
- Voice Assistant (LLM): ~1-1.5 GB
- **TTS Piper:** ~50 MB (не проблема!)
- **TTS Silero:** ~200 MB (тоже ОК!)

---

**Дата:** 2025-01-12  
**Автор:** GitHub Copilot  
**Статус:** Ready for testing ✅
