# ü§ñ ROBBOX Interactive Chat

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç —Å ROBBOX —Ä–æ–±–æ—Ç–æ–º, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π DeepSeek API, Silero TTS –∏ —Å–∏—Å—Ç–µ–º—É –∫–æ–º–∞–Ω–¥.

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ì–æ–ª–æ—Å–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã** —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º "–ë—É—Ä—É–Ω–¥—É–∫" (–∫–∞–∫ —É –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ ROBBOX)
- **SSML –∏–Ω—Ç–æ–Ω–∞—Ü–∏–∏** –¥–ª—è –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ–π —Ä–µ—á–∏ (–ø–∞—É–∑—ã, —Ç–æ–Ω, —Å–∫–æ—Ä–æ—Å—Ç—å)
- **–ö–æ–º–∞–Ω–¥—ã —Ä–æ–±–æ—Ç—É** (–¥–≤–∏–∂–µ–Ω–∏–µ, —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, LED —ç–º–æ—Ü–∏–∏)
- **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞** (—á–∏—Å–ª–∞ ‚Üí —Å–ª–æ–≤–∞, –ª–∞—Ç–∏–Ω–∏—Ü–∞ ‚Üí –∫–∏—Ä–∏–ª–ª–∏—Ü–∞)
- **JSON —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤** –æ—Ç DeepSeek

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd ~/rob_box_project/src/rob_box_voice
python3 -m pip install torch sounddevice openai
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API –∫–ª—é—á–∞

```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ .env.secrets:
export DEEPSEEK_API_KEY='your-deepseek-api-key'

# –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
source .env.secrets
```

### 3. –ó–∞–ø—É—Å–∫ —á–∞—Ç–∞

```bash
cd scripts
python3 robbox_chat.py
```

## üí¨ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥—ã —á–∞—Ç–∞

- `/quit` - –í—ã—Ö–æ–¥ –∏–∑ —á–∞—Ç–∞
- `/clear` - –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞
- `/history` - –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é

### –ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤

**–ü—Ä–æ—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã:**
```
üë§ –í—ã: –ø—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?
üë§ –í—ã: —Ä–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ
üë§ –í—ã: —á—Ç–æ —Ç—ã —É–º–µ–µ—à—å?
```

**–° –∫–æ–º–∞–Ω–¥–∞–º–∏:**
```
üë§ –í—ã: –ø–æ–µ–∑–∂–∞–π –≤–ø–µ—Ä—ë–¥
üë§ –í—ã: —Å—Ç–æ–ø, –æ—Å—Ç–∞–Ω–æ–≤–∏—Å—å
üë§ –í—ã: –≤–∫–ª—é—á–∏ —Å—á–∞—Å—Ç–ª–∏–≤—ã–µ —ç–º–æ—Ü–∏–∏
üë§ –í—ã: —Å–¥–µ–ª–∞–π –∫—Ä—É–≥–æ–≤–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
```

**–° –∏–Ω—Ç–æ–Ω–∞—Ü–∏—è–º–∏:**
```
üë§ –í—ã: —Ä–∞—Å—Å–∫–∞–∂–∏ —Å—Ç—Ä–∞—à–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é
üë§ –í—ã: —Ä–∞—Å—Å–∫–∞–∂–∏ –≤–µ—Å—ë–ª—É—é –∏—Å—Ç–æ—Ä–∏—é
üë§ –í—ã: —è —Ä–∞—Å—Å—Ç—Ä–æ–µ–Ω
```

## üìã –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ DeepSeek

DeepSeek –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON:

```json
{
  "text": "–û–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç (–±—É–¥–µ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω)",
  "ssml": "<speak><prosody rate='slow'>–¢–µ–∫—Å—Ç —Å –∏–Ω—Ç–æ–Ω–∞—Ü–∏—è–º–∏</prosody><break time='500ms'/>–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ</speak>",
  "commands": ["move_forward:0.3", "led_emotion:happy"],
  "emotion": "neutral"
}
```

### –ü–æ–ª—è

- **text** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) - –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞
- **ssml** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - SSML —Ä–∞–∑–º–µ—Ç–∫–∞ –¥–ª—è –∏–Ω—Ç–æ–Ω–∞—Ü–∏–π
- **commands** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –º–∞—Å—Å–∏–≤ –∫–æ–º–∞–Ω–¥ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **emotion** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - —ç–º–æ—Ü–∏—è: `neutral`, `happy`, `sad`, `thinking`, `alert`

## üé≠ SSML —Ç–µ–≥–∏

Silero TTS –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:

```xml
<!-- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–æ–Ω–∞ -->
<prosody pitch="low|medium|high|x-high">—Ç–µ–∫—Å—Ç</prosody>

<!-- –°–∫–æ—Ä–æ—Å—Ç—å —Ä–µ—á–∏ -->
<prosody rate="x-slow|slow|medium|fast">—Ç–µ–∫—Å—Ç</prosody>

<!-- –ü–∞—É–∑–∞ -->
<break time="500ms"/>

<!-- –û–±—ë—Ä—Ç–∫–∞ -->
<speak>—Ç–µ–∫—Å—Ç —Å —Ç–µ–≥–∞–º–∏</speak>
```

### –ü—Ä–∏–º–µ—Ä —Å –∏–Ω—Ç–æ–Ω–∞—Ü–∏—è–º–∏

```json
{
  "text": "–£—Ä–∞! –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞.",
  "ssml": "<speak><prosody pitch='high' rate='fast'>–£—Ä–∞!</prosody><break time='300ms'/>–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞.</speak>",
  "emotion": "happy"
}
```

## ü§ñ –ö–æ–º–∞–Ω–¥—ã —Ä–æ–±–æ—Ç–∞

### –î–≤–∏–∂–µ–Ω–∏–µ

- `move_forward:speed` - –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ø–µ—Ä—ë–¥ (speed: 0.1-1.0 –º/—Å)
- `move_backward:speed` - –¥–≤–∏–∂–µ–Ω–∏–µ –Ω–∞–∑–∞–¥
- `turn_left:angle` - –ø–æ–≤–æ—Ä–æ—Ç –≤–ª–µ–≤–æ (–≥—Ä–∞–¥—É—Å—ã)
- `turn_right:angle` - –ø–æ–≤–æ—Ä–æ—Ç –≤–ø—Ä–∞–≤–æ
- `stop` - –ø–æ–ª–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞

### –°–µ–Ω—Å–æ—Ä—ã

- `scan_360` - –∫—Ä—É–≥–æ–≤–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–∏–¥–∞—Ä–æ–º
- `get_battery` - –∑–∞–ø—Ä–æ—Å —É—Ä–æ–≤–Ω—è –±–∞—Ç–∞—Ä–µ–∏
- `get_sensors` - –∑–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö –≤—Å–µ—Ö —Å–µ–Ω—Å–æ—Ä–æ–≤

### –≠–º–æ—Ü–∏–∏ (LED –º–∞—Ç—Ä–∏—Ü–∞)

- `led_emotion:happy` - —Ä–∞–¥–æ—Å—Ç—å üòä
- `led_emotion:sad` - –≥—Ä—É—Å—Ç—å üò¢
- `led_emotion:thinking` - —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–µ ü§î
- `led_emotion:alert` - —Ç—Ä–µ–≤–æ–≥–∞ ‚ö†Ô∏è
- `led_emotion:neutral` - –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è üòê

### –ü—Ä–∏–º–µ—Ä —Å –∫–æ–º–∞–Ω–¥–∞–º–∏

```json
{
  "text": "–•–æ—Ä–æ—à–æ, –µ–¥—É –≤–ø–µ—Ä—ë–¥.",
  "commands": ["move_forward:0.3", "led_emotion:neutral"],
  "emotion": "neutral"
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Text Normalizer v2

```bash
cd scripts
python3 text_normalizer_v2.py
```

–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ—Ç:
- –ü–∞—Ä—Å–∏–Ω–≥ JSON
- –û–±—Ä–∞–±–æ—Ç–∫—É SSML
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é —Ç–µ–∫—Å—Ç–∞

### Silero TTS GUI

```bash
cd scripts
python3 silero_tts_gui.py
```

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–æ–ª–æ—Å–∞ —Å –±—É—Ä—É–Ω–¥—É–∫–æ–º:
- –í–∫–ª—é—á–∏—Ç–µ —á–µ–∫–±–æ–∫—Å "üêøÔ∏è –≠—Ñ—Ñ–µ–∫—Ç '–ë—É—Ä—É–Ω–¥—É–∫'"
- –í—ã–±–µ—Ä–∏—Ç–µ speaker: `aidar`
- –í—ã–±–µ—Ä–∏—Ç–µ rate: `x-slow`
- Pitch: `medium`
- Sample rate: `24000`

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
scripts/
‚îú‚îÄ‚îÄ robbox_chat.py           # –ì–ª–∞–≤–Ω—ã–π —á–∞—Ç
‚îú‚îÄ‚îÄ text_normalizer.py       # –ë–∞–∑–æ–≤—ã–π –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ç–æ—Ä
‚îú‚îÄ‚îÄ text_normalizer_v2.py    # –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π (JSON, SSML, –∫–æ–º–∞–Ω–¥—ã)
‚îú‚îÄ‚îÄ silero_tts_gui.py        # GUI –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è TTS
‚îî‚îÄ‚îÄ test_yandex_v3.py        # –¢–µ—Å—Ç—ã Yandex TTS

prompts/
‚îî‚îÄ‚îÄ master_prompt.txt        # –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è DeepSeek
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã TTS

–í `robbox_chat.py`:

```python
self.tts = SileroTTS(
    sample_rate=24000,      # 24kHz (–±—É–¥–µ—Ç 48kHz —Å –±—É—Ä—É–Ω–¥—É–∫–æ–º)
    chipmunk_mode=True      # –≠—Ñ—Ñ–µ–∫—Ç "–±—É—Ä—É–Ω–¥—É–∫"
)
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã DeepSeek

```python
response = self.client.chat.completions.create(
    model="deepseek-chat",
    messages=messages,
    temperature=0.7,        # –ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å (0.0-1.0)
    max_tokens=500          # –î–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞
)
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### DeepSeek –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ `master_prompt.txt` - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ñ–æ—Ä–º–∞—Ç—É JSON.

### –ù–µ—Ç –∑–≤—É–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤—ã–≤–æ–¥–∞:
python3 -c "import sounddevice as sd; print(sd.query_devices())"

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Silero TTS:
python3 silero_tts_gui.py
```

### –ö–æ–º–∞–Ω–¥—ã –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è

–í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –∫–æ–º–∞–Ω–¥—ã —Ç–æ–ª—å–∫–æ –ø–µ—á–∞—Ç–∞—é—Ç—Å—è. –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω—É–∂–Ω–∞ ROS2 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:

```python
# –í CommandExecutor.execute():
self.command_pub.publish(Command(name=command, param=param))
```

## üìö –ü—Ä–∏–º–µ—Ä—ã –¥–∏–∞–ª–æ–≥–æ–≤

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ

```
üë§ –í—ã: –ø—Ä–∏–≤–µ—Ç
ü§ñ ROBBOX [üòä happy]:
   üîä –ì–æ–≤–æ—Ä—é: –ü—Ä–∏–≤–µ—Ç!
   üêøÔ∏è –†–µ–∂–∏–º '–ë—É—Ä—É–Ω–¥—É–∫': pitch shift 2.0x
   ‚è∏Ô∏è –ü–∞—É–∑–∞ 200ms...
   üîä –ì–æ–≤–æ—Ä—é: –Ø –†–û–ë–ë–û–ö–° —Ä–æ–±–æ—Ç.
   üêøÔ∏è –†–µ–∂–∏–º '–ë—É—Ä—É–Ω–¥—É–∫': pitch shift 2.0x
   üîä –ì–æ–≤–æ—Ä—é: –†–∞–¥ –≤–∞—Å –≤–∏–¥–µ—Ç—å!
```

### –ü—Ä–∏–º–µ—Ä 2: –ö–æ–º–∞–Ω–¥–∞ –¥–≤–∏–∂–µ–Ω–∏—è

```
üë§ –í—ã: –ø–æ–µ–∑–∂–∞–π –≤–ø–µ—Ä—ë–¥ –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ 0.5
ü§ñ ROBBOX [üòê neutral]:
   ‚öôÔ∏è –í–´–ü–û–õ–ù–ï–ù–ò–ï –ö–û–ú–ê–ù–î:
   ü§ñ –ö–û–ú–ê–ù–î–ê: move_forward [0.5]
   ü§ñ –ö–û–ú–ê–ù–î–ê: led_emotion [neutral]
   üîä –ì–æ–≤–æ—Ä—é: –•–æ—Ä–æ—à–æ, –µ–¥—É –≤–ø–µ—Ä—ë–¥.
```

### –ü—Ä–∏–º–µ—Ä 3: –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç

```
üë§ –í—ã: —Ä–∞—Å—Å–∫–∞–∂–∏ –≤–µ—Å—ë–ª—É—é –∏—Å—Ç–æ—Ä–∏—é
ü§ñ ROBBOX [üòä happy]:
   üîä –ì–æ–≤–æ—Ä—é: –•–æ—Ä–æ—à–æ!
   ‚è∏Ô∏è –ü–∞—É–∑–∞ 300ms...
   üîä –ì–æ–≤–æ—Ä—é: –°–ª—É—à–∞–π—Ç–µ...
   ‚è∏Ô∏è –ü–∞—É–∑–∞ 500ms...
   üîä –ì–æ–≤–æ—Ä—é: –û–¥–Ω–∞–∂–¥—ã —è —Ä–µ—à–∏–ª –Ω–∞—É—á–∏—Ç—å—Å—è —Ç–∞–Ω—Ü–µ–≤–∞—Ç—å...
```

## üéì –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **DeepSeek Chat API** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤
- **Silero TTS v4** - —Å–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏ (—Ä—É—Å—Å–∫–∏–π)
- **Text Normalization** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞
- **SSML** - –∏–Ω—Ç–æ–Ω–∞—Ü–∏–∏ –∏ –ø–∞—É–∑—ã
- **Pitch Shift** - —ç—Ñ—Ñ–µ–∫—Ç "–±—É—Ä—É–Ω–¥—É–∫" (2.0x)

## üìù TODO

- [ ] ROS2 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è –∫–æ–º–∞–Ω–¥
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ voice input (STT)
- [ ] –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —ç–º–æ—Ü–∏–π –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏–∞–ª–æ–≥–æ–≤
- [ ] Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ß–∞—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ rob_box_project
