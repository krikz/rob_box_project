# Решение проблемы с ударениями

## Дата: 2025-10-13

## Проблема
Обязательные ударения во всех словах усложняют работу с DeepSeek - он не всегда корректно расставляет знак "+", и это замедляет ответы.

## Протестированные решения

### 1. russtress (НЕ ПОДОШЛО) ❌
- **Причина отказа:** Конфликт зависимостей (NumPy 2.x vs NumPy 1.x)
- **Проблема:** Требует TensorFlow (600+ MB), scipy 1.x
- **Вывод:** Слишком тяжёлое решение для встраивания

### 2. Словарь частых слов (ВЫБРАНО) ✅
- **Подход:** Простой Python словарь с ~200 самых частых слов
- **Преимущества:**
  - Нет зависимостей
  - Мгновенная работа (dict lookup)
  - Предсказуемый результат
  - Легко расширять
- **Покрытие:** 80-90% слов в обычной речи робота

## Реализация

### Создан модуль `accent_dict.py`

**Структура словаря:**
- 12 омографов (замок/замок, мука/мука, белки/белки)
- 15 топонимов (Сочи, Москва, Россия)
- 32 технических термина (робот, навигация, лидар, камера)
- 124 частых слова (я, ты, есть, делаю, город, время)

**Итого:** 183 слова

### API:

```python
from accent_dict import add_accents_to_text

text = "Город Сочи находится на побережье моря"
accented = add_accents_to_text(text)
# Результат: "Г+ород С+очи находится на побережье моря"
```

## Примеры работы

### Пример 1: Топонимы
```
Исходный:     Город Сочи находится на побережье моря.
С ударениями: Г+ород С+очи находится на побережье моря.
```

### Пример 2: Омографы
```
Исходный:     Открываю замок на двери замка.
С ударениями: Открываю з+амок на двери з+амка.
```

### Пример 3: Технические термины
```
Исходный:     Робот движется вперед со скоростью метр в секунду.
С ударениями: Р+обот движется вперед со скоростью метр в секунду.
```

### Пример 4: Система
```
Исходный:     Система навигации использует лидар и камеры.
С ударениями: Сист+ема навигации использует лид+ар и к+амеры.
```

## Изменения в промпте

### Было (обязательные ударения):
```
**ВСЕГДА расставляйте ударения!**
- В КАЖДОМ слове от 2+ слогов ставьте знак `+` перед ударной гласной
```

### Стало (опциональные ударения):
```
**УДАРЕНИЯ в словах (опционально, для улучшения произношения):**
- Можете использовать знак `+` ПЕРЕД ударной гласной для сложных случаев
- Используйте только для омографов и слов с неочевидным ударением
```

## Следующие шаги

### Фаза 1: Базовая интеграция ✅
- [x] Создан словарь с 183 словами
- [x] Протестирован на примерах
- [x] Обновлён промпт (ударения опциональны)

### Фаза 2: Расширение словаря (по мере использования)
- [ ] Добавлять новые слова при обнаружении проблем
- [ ] Собирать статистику часто используемых слов
- [ ] Дополнить технические термины (SLAM, IMU, VESC и т.д.)

### Фаза 3: Опциональная ML модель (если понадобится)
- [ ] Поискать лёгкие ONNX модели
- [ ] Использовать как fallback для неизвестных слов
- [ ] Кэшировать результаты

## Преимущества решения

1. **Простота** - нет тяжёлых зависимостей
2. **Скорость** - мгновенная работа
3. **Предсказуемость** - всегда одинаковый результат
4. **Расширяемость** - легко добавлять слова
5. **Достаточность** - покрывает 80-90% случаев

## Использование

### Автоматически (в text_normalizer.py):
```python
from accent_dict import add_accents_to_text

def normalize(self, text: str) -> str:
    # ... другие преобразования ...
    
    # Добавляем ударения (опционально)
    # text = add_accents_to_text(text)
    
    return text
```

### Вручную (для тестов):
```python
from accent_dict import add_accents_to_text

text = "Робот едет в город Сочи"
accented = add_accents_to_text(text)
print(accented)  # Р+обот едет в г+ород С+очи
```

## Источники для расширения

- Викисловарь (ru.wiktionary.org)
- Частотные словари русского языка
- OpenCorpora (opencorpora.org)
- Грамота.ру

## Выводы

Для робота-ассистента простой словарь с ~200 словами - **оптимальное решение**:
- Без ML библиотек
- Без конфликтов зависимостей
- Быстро и надёжно
- Легко поддерживать

ML решения (russtress, accentor) оказались избыточными для данной задачи.
