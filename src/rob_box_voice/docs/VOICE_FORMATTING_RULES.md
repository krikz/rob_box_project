# Правила форматирования текста для озвучивания

## Обзор

Этот документ описывает правила форматирования текста для синтеза речи с использованием Silero TTS v4.

## 1. Ударения (обязательно!)

### Правило
**ВСЕГДА расставляйте ударения во всех словах от 2+ слогов!**

Используйте знак `+` ПЕРЕД ударной гласной.

### Примеры

#### Обычные слова
```
р+обот
сист+ема
нав+игация
к+амера
сенс+ор
движ+ется
раб+отает
красив+ый
б+ыстрый
```

#### Топонимы
```
С+очи (город)
Москв+а
Р+оссия
Кит+ай
```

#### Омографы (особенно важно!)
```
з+амок (замόк - строение)
зам+ок (замóк - устройство)

м+ука (мýка - продукт)
мук+а (мукá - страдание)

б+елки (бéлки - животные)
белк+и (белкú - протеины)

+атлас (áтлас - карты)
атл+ас (атлáс - ткань)
```

### Полные предложения

❌ **НЕПРАВИЛЬНО (без ударений):**
```json
{"text": "Робот движется вперёд со скоростью один метр в секунду."}
```

✅ **ПРАВИЛЬНО (с ударениями):**
```json
{"text": "Р+обот движ+ется вперёд со скор+остью од+ин метр в сек+унду."}
```

## 2. Математические формулы

### Правило
**НЕ используйте Unicode математические символы!** Пишите формулы ПРОПИСЬЮ с ударениями.

### Индексы

❌ **НЕПРАВИЛЬНО:** `zₙ₊₁`, `x₀`, `aᵢ`
✅ **ПРАВИЛЬНО:** `z с +индексом n плюс од+ин`, `икс н+оль`, `а с +индексом и`

### Степени

❌ **НЕПРАВИЛЬНО:** `x²`, `a³`, `b⁴`
✅ **ПРАВИЛЬНО:** `икс в квадр+ате`, `а в к+убе`, `бэ в четвёртой ст+епени`

### Греческие буквы

| Символ | Неправильно | Правильно |
|--------|-------------|-----------|
| α | `α` | `+альфа` |
| β | `β` | `б+эта` |
| γ | `γ` | `г+амма` |
| δ | `δ` | `д+ельта` |
| θ | `θ` | `т+эта` |
| λ | `λ` | `л+ямбда` |
| π | `π` | `пи` |
| σ | `σ` | `с+игма` |
| ω | `ω` | `ом+ега` |

### Математические операторы

| Символ | Неправильно | Правильно |
|--------|-------------|-----------|
| ∫ | `∫` | `интегр+ал` |
| ∑ | `∑` | `с+умма` |
| ∏ | `∏` | `произвед+ение` |
| ∞ | `∞` | `бескон+ечность` |
| ≈ | `≈` | `прим+ерно р+авно` |
| ≠ | `≠` | `не р+авно` |
| ≤ | `≤` | `м+еньше +или р+авно` |
| ≥ | `≥` | `б+ольше +или р+авно` |
| √ | `√` | `к+орень` |

### Примеры формул

#### Множество Мандельброта

❌ **НЕПРАВИЛЬНО:**
```json
{"text": "Формула: zₙ₊₁ = zₙ² + c"}
```

✅ **ПРАВИЛЬНО:**
```json
{"text": "Ф+ормула: z с +индексом n плюс од+ин равн+о z в квадр+ате пл+юс c"}
```

**Озвучено:** "Формула: зет с индексом эн плюс один равно зет в квадрате плюс це"

#### Теорема Пифагора

❌ **НЕПРАВИЛЬНО:**
```json
{"text": "a² + b² = c²"}
```

✅ **ПРАВИЛЬНО:**
```json
{"text": "а в квадр+ате пл+юс бэ в квадр+ате равн+о це в квадр+ате"}
```

**Озвучено:** "а в квадрате плюс бэ в квадрате равно це в квадрате"

#### Интеграл

❌ **НЕПРАВИЛЬНО:**
```json
{"text": "∫₀^∞ f(x)dx"}
```

✅ **ПРАВИЛЬНО:**
```json
{"text": "интегр+ал от нул+я до бескон+ечности эф от икс дэ икс"}
```

#### Уравнение с греческими буквами

❌ **НЕПРАВИЛЬНО:**
```json
{"text": "α = 45°, β² = 16"}
```

✅ **ПРАВИЛЬНО:**
```json
{"text": "+альфа равн+а сор+ок пять град+усов, б+эта в квадр+ате равн+о шестн+адцать"}
```

## 3. Латинские буквы

Отдельные латинские буквы (не в словах) автоматически конвертируются в русское произношение:

```
A → эй
B → би
C → си
D → ди
E → и
F → эф
G → джи
H → эйч
I → ай
J → джей
K → кей
L → эл
M → эм
N → эн
O → оу
P → пи
Q → кью
R → ар
S → эс
T → ти
U → ю
V → ви
W → дабл ю
X → экс
Y → уай
Z → зет
```

**Пример:**
```
Входной текст: "A, B, C"
Озвучивание: "эй, би, си"
```

**Важно:** Это работает только для отдельных букв. Слова типа "LiDAR", "SLAM" остаются как есть (транслитерируются системой).

## 4. Числа

Числа автоматически конвертируются в слова:

```
1 → один
10 → десять
25 → двадцать пять
100 → сто
2014 → две тысячи четырнадцать
```

**Но в математических контекстах используйте прописные формы с ударениями:**

```
x₀ → икс н+оль (не "икс нуль")
n+1 → эн пл+юс од+ин
```

## 5. SSML теги

### Поддерживаемые теги

```xml
<speak>...</speak>                   <!-- Обёртка для SSML -->
<prosody rate="x-slow">...</prosody> <!-- Скорость речи -->
<prosody pitch="medium">...</prosody> <!-- Высота тона -->
<break time="500ms"/>                <!-- Пауза в миллисекундах -->
<break strength="strong"/>           <!-- Пауза по уровню -->
<p>...</p>                          <!-- Параграф (длинная пауза) -->
<s>...</s>                          <!-- Предложение (короткая пауза) -->
```

### Примеры

```json
{
  "text": "Привет мир",
  "ssml": "<speak><prosody rate='x-slow' pitch='medium'>Прив+ет мир</prosody></speak>"
}
```

```json
{
  "text": "Думаю. Решение найдено.",
  "ssml": "<speak><prosody rate='x-slow'>Д+умаю...</prosody><break time='800ms'/><prosody pitch='medium'>Реш+ение н+айдено.</prosody></speak>"
}
```

## 6. Полные примеры

### Пример 1: Простой ответ

```json
{
  "chunk": 1,
  "text": "Прив+ет! Я Р+оббокс р+обот.",
  "emotion": "happy"
}
```

### Пример 2: Математика

```json
{
  "chunk": 1,
  "text": "Мн+ожество М+андельброта опред+еляется ф+ормулой:",
  "emotion": "thinking"
}
```

```json
{
  "chunk": 2,
  "text": "z с +индексом n плюс од+ин равн+о z в квадр+ате пл+юс c",
  "emotion": "neutral"
}
```

### Пример 3: Топонимы

```json
{
  "chunk": 1,
  "text": "Г+ород С+очи наход+ится на побер+ежье Ч+ёрного м+оря.",
  "emotion": "neutral"
}
```

### Пример 4: С командами и паузами

```json
{
  "chunk": 1,
  "text": "Хорош+о, +еду вперёд.",
  "ssml": "<speak><prosody rate='x-slow'>Хорош+о,</prosody><break time='300ms'/><prosody pitch='medium'>+еду вперёд.</prosody></speak>",
  "commands": ["move_forward:0.3"],
  "emotion": "neutral"
}
```

## Проверочный список (Checklist)

Перед отправкой текста на озвучивание убедитесь:

- [ ] Ударения расставлены во ВСЕХ словах от 2+ слогов
- [ ] Нет Unicode математических символов (₀₁₂, ², ³, ∫, ∑, α, β и т.д.)
- [ ] Формулы записаны прописью с ударениями
- [ ] Греческие буквы записаны русскими буквами (`+альфа`, `б+эта` и т.д.)
- [ ] Математические операторы прописью (`интегр+ал`, `с+умма`, `бескон+ечность`)
- [ ] Индексы и степени прописью (`z с +индексом n`, `икс в квадр+ате`)
- [ ] В SSML тегах тоже расставлены ударения

## Технические детали

### Pitch Shift эффект

Система использует "бурундук режим":
- Sample rate синтеза: 24000 Hz
- Sample rate воспроизведения: 48000 Hz
- Результат: 2.0x pitch shift (голос выше и в 2 раза быстрее)

Поэтому:
- `rate="x-slow"` + pitch shift 2x = нормальная скорость
- `rate="medium"` + pitch shift 2x = очень быстро (только для восклицаний)

### Голос

По умолчанию используется голос `aidar` (мужской, чёткий).

---

**Дата обновления:** 2025-10-13
**Версия:** 1.0
