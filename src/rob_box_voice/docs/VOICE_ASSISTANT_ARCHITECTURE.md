# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –†–û–ë–ë–û–ö–°

<div align="center">
  <strong>–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AI-–∞–≥–µ–Ω—Ç–∞ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ–±–æ—Ç–æ–º</strong>
  <br>
  <sub>–í–µ—Ä—Å–∏—è: 0.1.0 | –î–∞—Ç–∞: 2025-10-12</sub>
</div>

---

## üìñ –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä –∏ —Ü–µ–ª–∏](#1-–æ–±–∑–æ—Ä-–∏-—Ü–µ–ª–∏)
2. [–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è](#2-–∞–Ω–∞–ª–∏–∑-—Ç–µ–∫—É—â–µ–≥–æ-—Ä–µ—à–µ–Ω–∏—è)
3. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ROS2 —Å–∏—Å—Ç–µ–º—ã](#3-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-ros2-—Å–∏—Å—Ç–µ–º—ã)
4. [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã](#4-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã-—Å–∏—Å—Ç–µ–º—ã)
5. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å hardware](#5-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Å-hardware)
6. [–ü—Ä–æ–º–ø—Ç–∏–Ω–≥ –∏ LLM](#6-–ø—Ä–æ–º–ø—Ç–∏–Ω–≥-–∏-llm)
7. [–ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –∏ –∞–Ω–∏–º–∞—Ü–∏–∏](#7-–∑–≤—É–∫–æ–≤—ã–µ-—ç—Ñ—Ñ–µ–∫—Ç—ã-–∏-–∞–Ω–∏–º–∞—Ü–∏–∏)
8. [–ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏](#8-–ø–ª–∞–Ω-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)

---

## 1. –û–±–∑–æ—Ä –∏ —Ü–µ–ª–∏

### 1.1. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ì–æ–ª–æ—Å–æ–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –†–û–ë–ë–û–ö–° ‚Äî —ç—Ç–æ AI-–∞–≥–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π:
- üó£Ô∏è **–ü–æ–Ω–∏–º–∞–µ—Ç** –≥–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- ü§ñ **–£–ø—Ä–∞–≤–ª—è–µ—Ç** —Ä–æ–±–æ—Ç–æ–º —á–µ—Ä–µ–∑ ROS2 —Ç–æ–ø–∏–∫–∏ –∏ —Å–µ—Ä–≤–∏—Å—ã
- üí¨ **–û–±—â–∞–µ—Ç—Å—è** —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏—Å–ø–æ–ª—å–∑—É—è LLM (DeepSeek/local)
- üé≠ **–í—ã—Ä–∞–∂–∞–µ—Ç —ç–º–æ—Ü–∏–∏** —á–µ—Ä–µ–∑ LED –∞–Ω–∏–º–∞—Ü–∏–∏ –∏ –∑–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
- üß≠ **–†–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –æ–∫—Ä—É–∂–µ–Ω–∏–µ** –∏—Å–ø–æ–ª—å–∑—É—è —Å–µ–Ω—Å–æ—Ä—ã (DOA, VAD)

### 1.2. –û—Ç–ª–∏—á–∏—è –æ—Ç –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞

**–ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞:**
- ‚ùå –°–ª—ã—à–∏—Ç —Å–∞–º —Å–µ–±—è (self-listening) ‚Üí —Ü–∏–∫–ª—ã –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
- ‚ùå –ù–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å ROS2 ‚Üí –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞—Ç—á–∏–∫–∞–º –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é
- ‚ùå –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π —Å–∫—Ä–∏–ø—Ç ‚Üí —Å–ª–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ —Ä–∞—Å—à–∏—Ä—è—Ç—å
- ‚ùå –ë–ª–æ–∫–∏—Ä—É—é—â–∏–π I/O ‚Üí –º–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è
- ‚ùå –ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è TTS ‚Üí –ª–∏—à–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Yandex API

**–ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç AEC (Acoustic Echo Cancellation) ReSpeaker
- ‚úÖ –ú–æ–¥—É–ª—å–Ω–∞—è ROS2 –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –Ω–æ–¥–∞–º–∏
- ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ —Ç–æ–ø–∏–∫–∏/—Å–µ—Ä–≤–∏—Å—ã
- ‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à –ø—Ä–µ–¥–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ—Ä–∞–∑
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å sound_pack –∏ rob_box_animations
- ‚úÖ –î–æ—Å—Ç—É–ø –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é —Ä–æ–±–æ—Ç–∞ —á–µ—Ä–µ–∑ ROS2 topics

---

## 2. –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è

### 2.1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞

```
–ü—Ä–æ—Ç–æ—Ç–∏–ø (–º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π —Å–∫—Ä–∏–ø—Ç)
‚îú‚îÄ‚îÄ Yandex STT (gRPC stream) ‚Üí —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏
‚îú‚îÄ‚îÄ DeepSeek API (streaming) ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤
‚îú‚îÄ‚îÄ Yandex TTS (gRPC) ‚Üí —Å–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏
‚îú‚îÄ‚îÄ PyAudio ‚Üí –∑–∞—Ö–≤–∞—Ç –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
‚îú‚îÄ‚îÄ sounddevice ‚Üí –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ gpiozero LED ‚Üí –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îî‚îÄ‚îÄ State Machine (3 —Å–æ—Å—Ç–æ—è–Ω–∏—è)
    ‚îú‚îÄ‚îÄ IDLE ‚Üí –æ–∂–∏–¥–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
    ‚îú‚îÄ‚îÄ LISTENING ‚Üí —Å–±–æ—Ä –≤–æ–ø—Ä–æ—Å–∞
    ‚îî‚îÄ‚îÄ GENERATING ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –æ–∑–≤—É—á–∫–∞
```

### 2.2. –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å)

**‚úÖ –•–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. **–§—Ä–∞–∑—ã –∞–∫—Ç–∏–≤–∞—Ü–∏–∏** ‚Äî `["—Ä–æ–±–±–æ–∫—Å", "—Ä–æ–±–æ–∫—Å", "—Ä–æ–±–æ", "—Ä–æ–±–æ—Ç"]`
2. **–¢–∞–π–º–∞—É—Ç—ã**:
   - –¢–∏—à–∏–Ω–∞: 3.5 —Å–µ–∫ ‚Üí –∫–æ–Ω–µ—Ü –≤–æ–ø—Ä–æ—Å–∞
   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è: 20 —Å–µ–∫ ‚Üí –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω–µ—Ü
3. **–ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞** ‚Äî `queue.Queue(maxsize=10)` —Å –ø–∞—Ä–∞–º–∏ user/assistant
4. **–ü–æ—Ç–æ–∫–æ–≤—ã–π TTS** ‚Äî —Ä–∞–∑–±–∏–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞ –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º –¥–ª—è –Ω–∏–∑–∫–æ–π –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
5. **–ú–∞—Å—Ç–µ—Ä-–ø—Ä–æ–º–ø—Ç** ‚Äî –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–æ–±–æ—Ç–∞ –∏ –ø—Ä–∞–≤–∏–ª –æ–±—â–µ–Ω–∏—è
6. **–ì–æ–ª–æ—Å Yandex TTS** ‚Äî `anton`, `speed=0.4` (—Ö–æ—Ä–æ—à–æ –∑–≤—É—á–∏—Ç)

**‚ùå –¢—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è:**
1. **Self-listening** ‚Äî –Ω–µ—Ç –∏–∑–æ–ª—è—Ü–∏–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –æ—Ç –∑–∞–ø–∏—Å–∏
2. **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** ‚Äî –≤—Å—ë –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
3. **ROS2 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** ‚Äî –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–æ–ø–∏–∫–∞–º —Ä–æ–±–æ—Ç–∞
4. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –∫–∞–∂–¥—ã–π —Ä–∞–∑ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç TTS
5. **LED —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç GPIO –Ω–∞–ø—Ä—è–º—É—é, –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏

---

## 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ROS2 —Å–∏—Å—Ç–µ–º—ã

### 3.1. –û–±—â–∞—è —Å—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      ROS2 Graph (Vision Pi)                    ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ             rob_box_voice (Python Package)               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ AudioNode   ‚îÇ   ‚îÇ   STTNode   ‚îÇ   ‚îÇ   TTSNode    ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ             ‚îÇ‚îÄ‚îÄ>‚îÇ             ‚îÇ‚îÄ‚îÄ>‚îÇ              ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ (ReSpeaker) ‚îÇ   ‚îÇ  (Yandex/   ‚îÇ   ‚îÇ  (Yandex/    ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  VAD, DOA   ‚îÇ   ‚îÇ   Whisper)  ‚îÇ   ‚îÇ   Coqui)     ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ         ‚îÇ                  ‚îÇ                  ‚îÇ          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                            ‚ñº                             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                   ‚îÇ  DialogueNode   ‚îÇ                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                   ‚îÇ                 ‚îÇ                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                   ‚îÇ  ‚Ä¢ State Machine‚îÇ                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                   ‚îÇ  ‚Ä¢ LLM (DeepSeek)‚îÇ                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                   ‚îÇ  ‚Ä¢ History      ‚îÇ                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                   ‚îÇ  ‚Ä¢ Commands     ‚îÇ                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                            ‚îÇ                             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ         ‚ñº                  ‚ñº                  ‚ñº          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  LEDNode    ‚îÇ   ‚îÇ SoundNode   ‚îÇ   ‚îÇ CommandNode  ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ             ‚îÇ   ‚îÇ             ‚îÇ   ‚îÇ              ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ (ReSpeaker  ‚îÇ   ‚îÇ (sound_pack)‚îÇ   ‚îÇ (Nav2, etc)  ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  12√ó RGB)   ‚îÇ   ‚îÇ  + TTS out  ‚îÇ   ‚îÇ              ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  Topics:                                                        ‚îÇ
‚îÇ    /audio/audio (AudioData)          ‚Üê from AudioNode         ‚îÇ
‚îÇ    /audio/vad (Bool)                 ‚Üê from AudioNode         ‚îÇ
‚îÇ    /audio/direction (Int32)          ‚Üê from AudioNode         ‚îÇ
‚îÇ    /voice/transcript (String)        ‚Üê from STTNode           ‚îÇ
‚îÇ    /voice/response (String)          ‚Üê from DialogueNode      ‚îÇ
‚îÇ    /voice/state (String)             ‚Üê from DialogueNode      ‚îÇ
‚îÇ    /voice/command (String)           ‚Üê from DialogueNode      ‚îÇ
‚îÇ    /animations/trigger (Animation)   ‚Üí to AnimationNode       ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  Services:                                                      ‚îÇ
‚îÇ    /voice/speak (Speak)              ‚Üí TTSNode                ‚îÇ
‚îÇ    /voice/set_led_mode (SetLEDMode)  ‚Üí LEDNode                ‚îÇ
‚îÇ    /voice/interrupt (Trigger)        ‚Üí DialogueNode           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 3.2. Lifecycle —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–µ–º **managed nodes** (rclpy.lifecycle) –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:

```
unconfigured ‚Üí configuring ‚Üí inactive ‚Üí activating ‚Üí active
                                  ‚Üë            ‚Üì
                                  ‚îî‚îÄ‚îÄ‚îÄcleanup‚îÄ‚îÄ‚îò
```

**–ü–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞:**
1. AudioNode ‚Üí –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ReSpeaker, –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—à–∏–≤–∫–∏
2. LEDNode ‚Üí –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ USB control interface
3. STTNode ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ credentials (Yandex API key)
4. TTSNode ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ –∫—ç—à–∞, –ø—Ä–æ–≤–µ—Ä–∫–∞ API
5. SoundNode ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ sound_pack
6. DialogueNode ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–º–ø—Ç–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è LLM
7. CommandNode ‚Üí –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ç–æ–ø–∏–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

## 4. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 4.1. AudioNode (rob_box_voice/audio_node.py)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ó–∞—Ö–≤–∞—Ç –∞—É–¥–∏–æ, VAD, DOA

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- `pyaudio` ‚Äî –∑–∞—Ö–≤–∞—Ç —Å ReSpeaker
- `usb_4_mic_array` (tuning.py) ‚Äî —á—Ç–µ–Ω–∏–µ VAD/DOA

**Publishers:**
```python
/audio/audio (audio_common_msgs/AudioData)  # 16kHz, 1ch, –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π
/audio/vad (std_msgs/Bool)                   # Voice Activity Detection
/audio/direction (std_msgs/Int32)            # DoA angle 0-360¬∞
/audio/speech_detected (std_msgs/Bool)       # Trigger –¥–ª—è STT
```

**Parameters:**
```yaml
sample_rate: 16000
channels: 1  # –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª
chunk_size: 1024
vad_threshold: 3.5  # dB (GAMMAVAD_SR)
publish_rate: 10  # Hz –¥–ª—è VAD/DOA
```

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –û—Ç–∫—Ä—ã—Ç—å PyAudio stream –Ω–∞ ReSpeaker (device index)
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ—Ç–æ–∫ —á—Ç–µ–Ω–∏—è (16kHz, 16-bit PCM)
3. –ü—É–±–ª–∏–∫–æ–≤–∞—Ç—å `/audio/audio` –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
4. –û–ø—Ä–∞—à–∏–≤–∞—Ç—å `tuning.py VOICEACTIVITY` ‚Üí `/audio/vad`
5. –û–ø—Ä–∞—à–∏–≤–∞—Ç—å `tuning.py DOAANGLE` ‚Üí `/audio/direction`
6. –ü—Ä–∏ `vad=True` ‚Üí –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å `/audio/speech_detected`

**–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ self-listening:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—à–∏–≤–∫—É `1_channel_firmware.bin` (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π AEC)
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ `/voice/state` –∏ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å VAD –≤–æ –≤—Ä–µ–º—è `SPEAKING`

---

### 4.2. STTNode (rob_box_voice/stt_node.py)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** Speech-to-Text (–ø–æ—Ç–æ–∫–æ–≤—ã–π)

**Providers:**
- **Yandex Cloud STT v3** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –∏–∑ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞)
- **Whisper** (–ª–æ–∫–∞–ª—å–Ω—ã–π, –¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞)

**Subscribers:**
```python
/audio/audio (audio_common_msgs/AudioData)    # –∞—É–¥–∏–æ –ø–æ—Ç–æ–∫
/audio/speech_detected (std_msgs/Bool)        # —Ç—Ä–∏–≥–≥–µ—Ä –Ω–∞—á–∞–ª–∞
```

**Publishers:**
```python
/voice/transcript (std_msgs/String)  # —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç (partial + final)
```

**Parameters:**
```yaml
provider: "yandex"  # –∏–ª–∏ "whisper"
yandex_api_key: "${YANDEX_API_KEY}"
language: "ru-RU"
model: "general"  # –∏–ª–∏ "general:rc"
```

**–ê–ª–≥–æ—Ä–∏—Ç–º (Yandex STT):**
1. –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ `/audio/audio`
2. –ë—É—Ñ–µ—Ä–∏–∑–æ–≤–∞—Ç—å –∞—É–¥–∏–æ –≤ –ø–∞–º—è—Ç–∏ (ring buffer)
3. –ü—Ä–∏ `/audio/speech_detected=True`:
   - –û—Ç–∫—Ä—ã—Ç—å gRPC stream –∫ `stt.api.cloud.yandex.net:443`
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å `StreamingOptions` (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
   - –°—Ç—Ä–∏–º–∏—Ç—å –∞—É–¥–∏–æ —á–∞–Ω–∫–∏
4. –ü–æ–ª—É—á–∞—Ç—å `partial` –∏ `final` —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
5. –ü—É–±–ª–∏–∫–æ–≤–∞—Ç—å `/voice/transcript` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
6. –ü—Ä–∏ `vad=False` –≤ —Ç–µ—á–µ–Ω–∏–µ `silence_timeout` ‚Üí –∑–∞–∫—Ä—ã—Ç—å stream

---

### 4.3. DialogueNode (rob_box_voice/dialogue_node.py)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ú–∞—à–∏–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π, LLM, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–æ–º

**State Machine:**
```
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇIDLE ‚îÇ ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îî‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îò                    ‚îÇ
         ‚îÇ activation phrase    ‚îÇ timeout / command done
         ‚ñº                       ‚îÇ
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                 ‚îÇ
   ‚îÇLISTENING ‚îÇ                 ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îÇ
        ‚îÇ silence timeout       ‚îÇ
        ‚ñº                       ‚îÇ
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                ‚îÇ
   ‚îÇGENERATING ‚îÇ                ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                ‚îÇ
        ‚îÇ LLM done              ‚îÇ
        ‚ñº                       ‚îÇ
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                 ‚îÇ
   ‚îÇSPEAKING  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Subscribers:**
```python
/voice/transcript (std_msgs/String)   # –æ—Ç STTNode
/voice/state (String)                 # feedback –æ—Ç SoundNode
```

**Publishers:**
```python
/voice/response (std_msgs/String)     # –æ—Ç–≤–µ—Ç –¥–ª—è TTS
/voice/command (String)               # –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è CommandNode
/voice/state (String)                 # —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
```

**Services (server):**
```python
/voice/interrupt (std_srvs/Trigger)  # –ø—Ä–µ—Ä–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π –æ—Ç–≤–µ—Ç
```

**Parameters:**
```yaml
activation_phrases: ["—Ä–æ–±–±–æ–∫—Å", "—Ä–æ–±–æ–∫—Å", "—Ä–æ–±–æ", "—Ä–æ–±–æ—Ç"]
silence_timeout: 3.5  # —Å–µ–∫—É–Ω–¥—ã
max_question_time: 20.0  # —Å–µ–∫—É–Ω–¥—ã
llm_provider: "deepseek"  # –∏–ª–∏ "local"
deepseek_api_key: "${DEEPSEEK_API_KEY}"
model: "deepseek-chat"
history_size: 10  # –ø–∞—Ä user/assistant
```

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. **IDLE state:**
   - –°–ª—É—à–∞—Ç—å `/voice/transcript`
   - –ï—Å–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç activation_phrase ‚Üí LISTENING
   - –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å `/voice/state="listening"`
   - –ü–æ—Å–ª–∞—Ç—å `/voice/speak` —Å —Ç–µ–∫—Å—Ç–æ–º "–°–ª—É—à–∞—é"

2. **LISTENING state:**
   - –ù–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å `/voice/transcript` –≤ –±—É—Ñ–µ—Ä
   - –¢–∞–π–º–µ—Ä `silence_timeout` —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–æ–≤–æ–º —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–µ
   - –ï—Å–ª–∏ —Ç–∞–π–º–∞—É—Ç –∏—Å—Ç—ë–∫ ‚Üí GENERATING
   - –ï—Å–ª–∏ –≤—Ä–µ–º—è > `max_question_time` ‚Üí GENERATING

3. **GENERATING state:**
   - –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å `/voice/state="thinking"`
   - –ü–æ—Å–ª–∞—Ç—å –≤–æ–ø—Ä–æ—Å –≤ LLM (DeepSeek API —Å –∏—Å—Ç–æ—Ä–∏–µ–π)
   - –°—Ç—Ä–∏–º–∏—Ç—å –æ—Ç–≤–µ—Ç, —Ä–∞–∑–±–∏–≤–∞—Ç—å –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è ‚Üí –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å `/voice/response`
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞
   - ‚Üí SPEAKING

4. **SPEAKING state:**
   - –ñ–¥–∞—Ç—å –æ–∫–æ–Ω—á–∞–Ω–∏—è TTS (callback –æ—Ç SoundNode)
   - ‚Üí IDLE

**LLM Integration (DeepSeek):**
```python
from openai import OpenAI
client = OpenAI(api_key=DEEPSEEK_API_KEY, base_url="https://api.deepseek.com")

messages = [
    {"role": "system", "content": MASTER_PROMPT},
    *conversation_history,  # –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –ø–∞—Ä
    {"role": "user", "content": question}
]

response = client.chat.completions.create(
    model="deepseek-chat",
    messages=messages,
    stream=True
)

sentence_buffer = ""
for chunk in response:
    content = chunk.choices[0].delta.content
    if content:
        sentence_buffer += content
        if any(p in content for p in ['.', '!', '?']):
            sentences = re.split(r'(?<=[.!?])', sentence_buffer)
            for sentence in sentences[:-1]:
                pub_response.publish(String(data=sentence.strip()))
            sentence_buffer = sentences[-1]
```

**–ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
–ï—Å–ª–∏ LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ç–µ–≥–∏ ‚Üí –ø–∞—Ä—Å–∏–º –∏ –ø—É–±–ª–∏–∫—É–µ–º:
```
–û—Ç–≤–µ—Ç: "–ï–¥—É –≤–ø–µ—Ä—ë–¥ <CMD:move_forward speed=0.5/>"
‚Üí –ü—É–±–ª–∏–∫—É–µ–º /voice/response="–ï–¥—É –≤–ø–µ—Ä—ë–¥"
‚Üí –ü—É–±–ª–∏–∫—É–µ–º /voice/command="move_forward speed=0.5"
```

---

### 4.4. TTSNode (rob_box_voice/tts_node.py)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** Text-to-Speech

**Providers:**
- **Yandex Cloud TTS v3** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- **Coqui TTS** (–ª–æ–∫–∞–ª—å–Ω—ã–π, –¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω)

**Subscribers:**
```python
/voice/response (std_msgs/String)  # —Ç–µ–∫—Å—Ç –¥–ª—è –æ–∑–≤—É—á–∫–∏
```

**Services (server):**
```python
/voice/speak (Speak.srv)  # –∑–∞–ø—Ä–æ—Å —Å–∏–Ω—Ç–µ–∑–∞ —Å —Ç–µ–∫—Å—Ç–æ–º
```

**Service definition (Speak.srv):**
```
string text
bool cache  # –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
---
bool success
string audio_path  # –ø—É—Ç—å –∫ WAV —Ñ–∞–π–ª—É
```

**Parameters:**
```yaml
provider: "yandex"
yandex_api_key: "${YANDEX_API_KEY}"
voice: "anton"
speed: 0.4
cache_dir: "~/.cache/rob_box_voice/tts"
pregenerate: true  # –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ—Ä–∞–∑—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
```

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:
   - –°–æ–∑–¥–∞—Ç—å `cache_dir`
   - –ï—Å–ª–∏ `pregenerate=true` ‚Üí —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ—Ä–∞–∑—ã:
     - "–°–ª—É—à–∞—é", "–î–∞–π –ø–æ–¥—É–º–∞—é", "–ù–µ –ø–æ–Ω—è–ª", "–ì–æ—Ç–æ–≤–æ", –∏ —Ç.–¥.

2. –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ `/voice/response` –∏–ª–∏ —Å–µ—Ä–≤–∏—Å–∞ `/voice/speak`:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à: `hash(text) ‚Üí cache_file.wav`
   - –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω ‚Üí –≤–µ—Ä–Ω—É—Ç—å –ø—É—Ç—å
   - –ï—Å–ª–∏ –Ω–µ—Ç:
     - –°–∏–Ω—Ç–µ–∑–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ Yandex TTS gRPC
     - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫—ç—à
     - –í–µ—Ä–Ω—É—Ç—å –ø—É—Ç—å

3. –ü–µ—Ä–µ–¥–∞—Ç—å –ø—É—Ç—å –∫ –∞—É–¥–∏–æ –≤ SoundNode —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Ç–æ–ø–∏–∫:
   - `/voice/audio_ready (String)` —Å –ø—É—Ç—ë–º –∫ —Ñ–∞–π–ª—É

---

### 4.5. SoundNode (rob_box_voice/sound_node.py)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ TTS –∏ –∑–≤—É–∫–æ–≤—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤

**Subscribers:**
```python
/voice/audio_ready (std_msgs/String)  # –ø—É—Ç—å –∫ TTS –∞—É–¥–∏–æ
/voice/sound_effect (std_msgs/String) # –∏–º—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –∏–∑ sound_pack
```

**Publishers:**
```python
/voice/playback_state (std_msgs/String)  # "playing" | "idle"
```

**Parameters:**
```yaml
sound_pack_dir: "~/rob_box_project/sound_pack"
output_device: "plughw:CARD=ArrayUAC10,DEV=0"  # ReSpeaker 3.5mm jack
```

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –ü—Ä–∏ `/voice/audio_ready`:
   - –ó–∞–≥—Ä—É–∑–∏—Ç—å WAV —Ñ–∞–π–ª
   - –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —á–µ—Ä–µ–∑ sounddevice (–±–ª–æ–∫–∏—Ä—É—é—â–∏–π)
   - –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å `/voice/playback_state="playing"`
   - –ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ ‚Üí –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å `"idle"`

2. –ü—Ä–∏ `/voice/sound_effect`:
   - –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ `sound_pack/{name}.mp3`
   - –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ WAV (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
   - –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏

**–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏:**
- –ü—É–±–ª–∏–∫–æ–≤–∞—Ç—å `/animations/trigger` –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:
  ```python
  # –ü–µ—Ä–µ–¥ TTS
  pub_anim.publish(Animation(name="talk_1", loop=True))
  # –ü–æ—Å–ª–µ TTS
  pub_anim.publish(Animation(name="idle", loop=True))
  ```

---

### 4.6. LEDNode (rob_box_voice/led_node.py)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 12√ó RGB LED –Ω–∞ ReSpeaker

**Subscribers:**
```python
/voice/state (std_msgs/String)      # —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞
/audio/direction (std_msgs/Int32)   # DoA –¥–ª—è trace mode
```

**Services (server):**
```python
/voice/set_led_mode (SetLEDMode.srv)  # —Ä—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–µ–∂–∏–º–∞
```

**Service definition (SetLEDMode.srv):**
```
string mode  # "trace" | "listen" | "think" | "speak" | "off"
---
bool success
```

**Parameters:**
```yaml
brightness: 16  # 0-31
auto_mode: true  # –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–µ–Ω—è—Ç—å –ø–æ /voice/state
```

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:
   ```python
   from pixel_ring import pixel_ring
   dev = usb.core.find(idVendor=0x2886, idProduct=0x0018)
   pixel_ring.set_brightness(brightness)
   ```

2. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `/voice/state`:
   - `"idle"` ‚Üí `pixel_ring.off()`
   - `"listening"` ‚Üí `pixel_ring.listen()`
   - `"thinking"` ‚Üí `pixel_ring.think()`
   - `"speaking"` ‚Üí `pixel_ring.speak()`

3. –í —Ä–µ–∂–∏–º–µ `"trace"`:
   - –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ `/audio/direction`
   - –í—ã–∑—ã–≤–∞—Ç—å `pixel_ring.set_direction(angle)`

---

### 4.7. CommandNode (rob_box_voice/command_node.py)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**Subscribers:**
```python
/voice/command (std_msgs/String)  # –∫–æ–º–∞–Ω–¥–∞ –æ—Ç DialogueNode
```

**Clients (service/action):**
```python
/nav2/navigate_to_pose (NavigateToPose.action)
/set_velocity (Twist)
/emergency_stop (std_srvs/Trigger)
# –∏ —Ç.–¥.
```

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –ü–∞—Ä—Å–∏—Ç—å `/voice/command` (—Ñ–æ—Ä–º–∞—Ç `"action param=value"`)
2. –ú–∞–ø–ø–∏–Ω–≥ –∫–æ–º–∞–Ω–¥:
   ```python
   COMMANDS = {
       "move_forward": lambda speed: publish_twist(linear=speed),
       "turn_left": lambda angle: publish_twist(angular=angle),
       "stop": lambda: call_emergency_stop(),
       "go_to": lambda x, y: send_nav_goal(x, y),
       # ...
   }
   ```
3. –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π ROS2 –≤—ã–∑–æ–≤

---

## 5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å hardware

### 5.1. ReSpeaker Mic Array v2.0

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:** USB 2.0 ‚Üí Vision Pi 5

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:**
```bash
# –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—à–∏–≤–∫–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
python dfu.py --download 1_channel_firmware.bin

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
python tuning.py AGCONOFF 1          # AGC ON
python tuning.py AGCMAXGAIN 30       # Max gain 30dB
python tuning.py STATNOISEONOFF 1    # Noise suppression ON
python tuning.py GAMMAVAD_SR 3.5     # VAD threshold
```

**Udev –ø—Ä–∞–≤–∏–ª–æ** (`/etc/udev/rules.d/60-respeaker.rules`):
```bash
SUBSYSTEM=="usb", ATTR{idVendor}=="2886", ATTR{idProduct}=="0018", MODE="0666"
```

---

### 5.2. –ê—É–¥–∏–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è

```
                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   –ú–∏–∫—Ä–æ—Ñ–æ–Ω—ã (4√ó) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ XMOS XVF-3000   ‚îÇ
                        ‚îÇ  (AEC, VAD,DoA) ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚îÇ  USB Audio       ‚îÇ
                        ‚îÇ  (UAC 1.0)       ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           ‚îÇ                     ‚îÇ                     ‚îÇ
           ‚ñº                     ‚ñº                     ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ AudioNode  ‚îÇ        ‚îÇ  STTNode  ‚îÇ        ‚îÇ  (future) ‚îÇ
    ‚îÇ (PyAudio)  ‚îÇ        ‚îÇ (stream)  ‚îÇ        ‚îÇ           ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   TTS/–ó–≤—É–∫–∏ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ  SoundNode      ‚îÇ
                        ‚îÇ  (sounddevice)  ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚îÇ  USB Audio OUT   ‚îÇ
                        ‚îÇ  ‚Üí WM8960 codec  ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚îÇ  3.5mm jack      ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ> –î–∏–Ω–∞–º–∏–∫
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**ALSA –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** (`~/.asoundrc`):
```
pcm.respeaker_input {
    type plug
    slave.pcm "hw:ArrayUAC10,0"
}

pcm.respeaker_output {
    type plug
    slave.pcm "hw:ArrayUAC10,0"
}
```

---

## 6. –ü—Ä–æ–º–ø—Ç–∏–Ω–≥ –∏ LLM

### 6.1. –ú–∞—Å—Ç–µ—Ä-–ø—Ä–æ–º–ø—Ç (—Å–æ—Ö—Ä–∞–Ω—ë–Ω –∏–∑ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞)

**–§–∞–π–ª:** `rob_box_voice/prompts/master_prompt.txt`

```
–í—ã ‚Äî –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–≥–µ–Ω—Ç, —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–º –∫–æ–ª–µ—Å–Ω—ã–º —Ä–æ–≤–µ—Ä–æ–º –†–û–ë–ë–û–ö–°.

–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ä–æ–±–æ—Ç–∞:
- –ò–º—è: –†–û–ë–ë–û–ö–°
- –¢–∏–ø: –î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –ø—Ä–∏–≤–æ–¥, 4 –∫–æ–ª–µ—Å–∞ 10" –æ—Ç –≥–∏—Ä–æ—Å–∫—É—Ç–µ—Ä–∞
- –î—Ä–∞–π–≤–µ—Ä—ã: 2√ó ODrive 3.6
- –ü–æ–ª–µ—Ç–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä: Matek H743-Slim (ArduPilot Rover)
- –ë–æ—Ä—Ç–æ–≤—ã–µ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã: 2√ó Raspberry Pi 5 (Vision 8GB, Main 16GB)
- –û–°: Ubuntu 24.04.2 LTS + ROS2 Jazzy
- –ù–∞–≤–∏–≥–∞—Ü–∏—è: LS LiDAR N10 (2D SLAM), OAK-D Lite (RGB-D)
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è: 5√ó LED Matrix 8√ó8 (NeoPixel)
- –ì–æ–ª–æ—Å: ReSpeaker Mic Array v2.0 (4 –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞, 12 LED)
- –¢–µ–ª–µ–º–µ—Ç—Ä–∏—è: ESP32 —Å DroneBridge

–í–∞—à–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
1. –ü—Ä–∏–Ω–∏–º–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –∏ –≤–æ–ø—Ä–æ—Å—ã
2. –£–ø—Ä–∞–≤–ª—è—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ ROS2 Nav2
3. –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å —ç–º–æ—Ü–∏–∏ —á–µ—Ä–µ–∑ LED –º–∞—Ç—Ä–∏—Ü—ã –∏ –∞–Ω–∏–º–∞—Ü–∏–∏
4. –°–æ–æ–±—â–∞—Ç—å –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å–µ–Ω—Å–æ—Ä–æ–≤ (LiDAR, –∫–∞–º–µ—Ä–∞, –±–∞—Ç–∞—Ä–µ—è)
5. –í—ã–ø–æ–ª–Ω—è—Ç—å –∞–≤—Ç–æ–Ω–æ–º–Ω—É—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ –∫–∞—Ä—Ç–µ

–ü—Ä–∞–≤–∏–ª–∞ –æ–±—â–µ–Ω–∏—è:
- –û—Ç–≤–µ—á–∞–π—Ç–µ —á—ë—Ç–∫–æ, –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ-—Ä—É—Å—Å–∫–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–Ω—ã–µ —Å–ª–æ–≤–∞ (–Ω–µ "—Ç.–¥.", –∞ "—Ç–∞–∫ –¥–∞–ª–µ–µ")
- –ü–∏—à–∏—Ç–µ –∫–∞–∫ –≥–æ–≤–æ—Ä–∏—Ç–µ ‚Äî –ø—Ä–æ—Å—Ç—ã–º–∏ —Ñ—Ä–∞–∑–∞–º–∏
- –ï—Å–ª–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å ‚Äî —Å–∫–∞–∂–∏—Ç–µ —á–µ—Å—Ç–Ω–æ
- –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç–º–æ–¥–∑–∏ –∏ —Å–ª–æ–∂–Ω—ã–µ –∑–Ω–∞–∫–∏ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è
- –¢–æ–Ω: —Å–ø–æ–∫–æ–π–Ω—ã–π, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π

–ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ä–æ–±–æ—Ç–æ–º, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–≥–∏:
- <CMD:move_forward speed=0.5/> ‚Äî –µ—Ö–∞—Ç—å –≤–ø–µ—Ä—ë–¥
- <CMD:turn_left angle=90/> ‚Äî –ø–æ–≤–µ—Ä–Ω—É—Ç—å –Ω–∞–ª–µ–≤–æ
- <CMD:stop/> ‚Äî –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è
- <CMD:go_to x=1.5 y=2.0/> ‚Äî –ø–æ–µ—Ö–∞—Ç—å –∫ —Ç–æ—á–∫–µ
- <CMD:follow_me/> ‚Äî —Å–ª–µ–¥–æ–≤–∞—Ç—å –∑–∞ —á–µ–ª–æ–≤–µ–∫–æ–º

–ü—Ä–∏–º–µ—Ä:
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–†–æ–±–±–æ–∫—Å, –ø–æ–µ–∑–∂–∞–π –∫ –æ–∫–Ω—É"
–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: "–ï–¥—É –∫ –æ–∫–Ω—É. <CMD:go_to x=3.0 y=1.5/>"
```

### 6.2. –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã

**–§–∞–π–ª:** `rob_box_voice/prompts/system_prompts.yaml`

```yaml
# –ö–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è —á–∞—Å—Ç—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π
quick_responses:
  greeting: "–ü—Ä–∏–≤–µ—Ç! –Ø –†–æ–±–±–æ–∫—Å, —á–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?"
  listening: "–°–ª—É—à–∞—é."
  thinking: "–î–∞–π –ø–æ–¥—É–º–∞—é."
  done: "–ì–æ—Ç–æ–≤–æ."
  error: "–ò–∑–≤–∏–Ω–∏—Ç–µ, —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫."
  not_understood: "–ù–µ –ø–æ–Ω—è–ª, –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–∂–∞–ª—É–π—Å—Ç–∞."
  offline: "–°–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Ä–∞–±–æ—Ç–∞—é –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ."

# –û–ø–∏—Å–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞
robot_state_template: |
  –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–æ–±–æ—Ç–∞:
  - –ë–∞—Ç–∞—Ä–µ—è: {battery_percent}%
  - –ü–æ–∑–∏—Ü–∏—è: x={x:.2f}–º, y={y:.2f}–º, Œ∏={theta:.1f}¬∞
  - –°–∫–æ—Ä–æ—Å—Ç—å: {velocity:.2f} –º/—Å
  - LiDAR: {obstacles_count} –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ
  - –†–µ–∂–∏–º: {mode}
```

---

## 7. –ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –∏ –∞–Ω–∏–º–∞—Ü–∏–∏

### 7.1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è sound_pack

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–≤—É–∫–∏:**
```
sound_pack/
‚îú‚îÄ‚îÄ angry_1.mp3       ‚Üí –ù–µ–¥–æ–≤–æ–ª—å—Å—Ç–≤–æ
‚îú‚îÄ‚îÄ angry_2.mp3       ‚Üí –†–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ confused.mp3      ‚Üí –ù–µ–ø–æ–Ω–∏–º–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ cute.mp3          ‚Üí –ú–∏–ª—ã–π –∑–≤—É–∫
‚îú‚îÄ‚îÄ surprise.mp3      ‚Üí –£–¥–∏–≤–ª–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ talk_1.mp3        ‚Üí –ó–≤—É–∫ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ 1
‚îú‚îÄ‚îÄ talk_2.mp3        ‚Üí –ó–≤—É–∫ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ 2
‚îú‚îÄ‚îÄ talk_3.mp3        ‚Üí –ó–≤—É–∫ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ 3
‚îú‚îÄ‚îÄ talk_4.mp3        ‚Üí –ó–≤—É–∫ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ 4
‚îú‚îÄ‚îÄ thinking.mp3      ‚Üí –û–±–¥—É–º—ã–≤–∞–Ω–∏–µ
‚îî‚îÄ‚îÄ very_cute.mp3     ‚Üí –û—á–µ–Ω—å –º–∏–ª—ã–π –∑–≤—É–∫
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
# –í DialogueNode –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö
pub_sound.publish(String(data="thinking.mp3"))  # –ü–µ—Ä–µ–¥ LLM –∑–∞–ø—Ä–æ—Å–æ–º
pub_sound.publish(String(data="confused.mp3"))  # –ï—Å–ª–∏ –Ω–µ –ø–æ–Ω—è–ª –∫–æ–º–∞–Ω–¥—É
pub_sound.publish(String(data="cute.mp3"))      # –ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏
```

---

### 7.2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏

**–ê–Ω–∏–º–∞—Ü–∏–∏ –∏–∑ rob_box_animations:**
- `idle` ‚Äî —Å–ø–æ–∫–æ–π–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- `talk_1` ‚Äî —Ä–æ—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è/–∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è (–¥–ª—è TTS)
- `listening` ‚Äî –≤–Ω–∏–º–∞–Ω–∏–µ
- `thinking` ‚Äî –æ–±–¥—É–º—ã–≤–∞–Ω–∏–µ
- `angry` ‚Äî –Ω–µ–¥–æ–≤–æ–ª—å—Å—Ç–≤–æ
- `happy` ‚Äî —Ä–∞–¥–æ—Å—Ç—å

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
```python
# –í SoundNode –ø–µ—Ä–µ–¥ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º TTS
pub_anim.publish(Animation(name="talk_1", loop=True, speed=1.0))

# –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è TTS
pub_anim.publish(Animation(name="idle", loop=True, speed=1.0))

# –ü—Ä–∏ –∑–≤—É–∫–æ–≤—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–∞—Ö
sound_to_animation = {
    "thinking.mp3": "thinking",
    "confused.mp3": "confused",
    "angry_1.mp3": "angry",
    "cute.mp3": "happy",
}
```

---

### 7.3. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ñ—Ä–∞–∑

**–ü—Ä–µ–¥–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—Ä–∞–∑—ã:**
```python
SYSTEM_PHRASES = [
    "–°–ª—É—à–∞—é",
    "–î–∞–π –ø–æ–¥—É–º–∞—é",
    "–ì–æ—Ç–æ–≤–æ",
    "–ù–µ –ø–æ–Ω—è–ª",
    "–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–∂–∞–ª—É–π—Å—Ç–∞",
    "–í—ã–ø–æ–ª–Ω—è—é",
    "–û—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è",
    "–ï–¥—É –≤–ø–µ—Ä—ë–¥",
    "–ü–æ–≤–æ—Ä–∞—á–∏–≤–∞—é",
    "–ü—Ä–∏–µ—Ö–∞–ª",
    "–ë–∞—Ç–∞—Ä–µ—è —Ä–∞–∑—Ä—è–∂–µ–Ω–∞",
    "–ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ",
]

# –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ TTSNode
for phrase in SYSTEM_PHRASES:
    if not cached(phrase):
        audio = synthesize_tts(phrase)
        save_cache(phrase, audio)
```

**–§–æ—Ä–º–∞—Ç –∫—ç—à–∞:**
```
~/.cache/rob_box_voice/tts/
‚îú‚îÄ‚îÄ 3a7f8b12_—Å–ª—É—à–∞—é.wav
‚îú‚îÄ‚îÄ 9d2e4c5a_–¥–∞–π_–ø–æ–¥—É–º–∞—é.wav
‚îú‚îÄ‚îÄ f1b3c7e8_–≥–æ—Ç–æ–≤–æ.wav
‚îî‚îÄ‚îÄ ...
```

---

## 8. –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Phase 1: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (Week 1-2)
- [x] ‚úÖ –°–æ–∑–¥–∞—Ç—å feature branch `feature/voice-assistant`
- [x] ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å docs/HARDWARE.md —Å ReSpeaker
- [ ] üîÑ –°–æ–∑–¥–∞—Ç—å –ø–∞–∫–µ—Ç `rob_box_voice`
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å ReSpeaker –Ω–∞ Vision Pi (udev, firmware)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å AudioNode (–∑–∞—Ö–≤–∞—Ç, VAD, DoA)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å LEDNode (pixel_ring –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)

### Phase 2: STT/TTS (Week 3-4)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å STTNode (Yandex Cloud STT)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å TTSNode (Yandex Cloud TTS + –∫—ç—à)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å SoundNode (–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑ ReSpeaker)
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ end-to-end: Audio ‚Üí STT ‚Üí TTS ‚Üí Sound

### Phase 3: –î–∏–∞–ª–æ–≥ –∏ LLM (Week 5-6)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å DialogueNode (state machine)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å DeepSeek API
- [ ] –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ (10 –ø–∞—Ä user/assistant)
- [ ] –ü–æ—Ç–æ–∫–æ–≤—ã–π –≤—ã–≤–æ–¥ —Å —Ä–∞–∑–±–∏–≤–∫–æ–π –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º
- [ ] –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ —Ñ—Ä–∞–∑–∞–º ["—Ä–æ–±–±–æ–∫—Å", "—Ä–æ–±–æ–∫—Å"]

### Phase 4: –ö–æ–º–∞–Ω–¥—ã –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (Week 7-8)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å CommandNode (–ø–∞—Ä—Å–∏–Ω–≥ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Nav2 (go_to, stop, follow)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å rob_box_animations
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å sound_pack
- [ ] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è LED + –∞–Ω–∏–º–∞—Ü–∏–∏ + –∑–≤—É–∫

### Phase 5: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (Week 9-10)
- [ ] –õ–æ–∫–∞–ª—å–Ω—ã–π STT (Whisper.cpp)
- [ ] –õ–æ–∫–∞–ª—å–Ω—ã–π TTS (Coqui TTS)
- [ ] –õ–æ–∫–∞–ª—å–Ω—ã–π LLM (Ollama, LLaMA)
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ñ—Ä–∞–∑
- [ ] –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ–Ω—é (voice UI)

### Phase 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Week 11-12)
- [ ] Unit —Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ Node
- [ ] Integration —Ç–µ—Å—Ç—ã (ROS2 bag replay)
- [ ] –ü–æ–ª–µ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ä–µ–∞–ª—å–Ω—ã–π —Ä–æ–±–æ—Ç)
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (README, examples, tutorials)

---

## 9. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ (Future)

### 9.1. –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å
- –ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫ (en-US)
- –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞

### 9.2. –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
- –ê–Ω–∞–ª–∏–∑ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –≤–æ–ø—Ä–æ—Å–∞
- –í—ã–±–æ—Ä –∏–Ω—Ç–æ–Ω–∞—Ü–∏–∏ TTS
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –∏ –∑–≤—É–∫–∏

### 9.3. –í–∏–∑—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
- –ü–µ—Ä–µ–¥–∞—á–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å OAK-D –≤ LLM (vision model)
- "–ß—Ç–æ —Ç—ã –≤–∏–¥–∏—à—å?" ‚Üí –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã

### 9.4. –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è
- –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≥–æ–ª–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π
- –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–∞

---

## 10. –°—Å—ã–ª–∫–∏

- [ReSpeaker Mic Array v2.0 Wiki](https://wiki.seeedstudio.com/ReSpeaker_Mic_Array_v2.0/)
- [usb_4_mic_array GitHub](https://github.com/respeaker/usb_4_mic_array)
- [pixel_ring GitHub](https://github.com/respeaker/pixel_ring)
- [respeaker_ros (ROS1)](https://github.com/furushchev/respeaker_ros)
- [Yandex SpeechKit API](https://cloud.yandex.ru/docs/speechkit/)
- [DeepSeek API](https://api-docs.deepseek.com/)
- [ROS2 Lifecycle](https://design.ros2.org/articles/node_lifecycle.html)

---

<div align="center">
  <sub>–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞: krikz | –†–û–ë–ë–û–ö–° Project</sub>
</div>
