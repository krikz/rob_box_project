# Исследование решений для расстановки ударений

## Проблема
Нужна автоматическая расстановка ударений в русском тексте для Silero TTS.

## Протестированные библиотеки

### 1. russtress ❌
- **Репозиторий:** https://github.com/MashaPo/russtress
- **Проблема:** Требует TensorFlow и NumPy 1.x (конфликт с NumPy 2.x в системе)
- **Вердикт:** Слишком тяжёлые зависимости, конфликт версий

### 2. accentor
- **Репозиторий:** https://github.com/Desklop/accentor
- **Статус:** Не тестирована (вероятно те же проблемы с TensorFlow)

### 3. russian-accentuation
- **Репозиторий:** https://github.com/reynoldsnlp/russian-accentuation
- **Статус:** Не тестирована

## Альтернативные подходы

### Подход 1: Словарь частых слов (рекомендуется)
**Идея:** Создать словарь с ударениями для самых частых русских слов

**Преимущества:**
- ✅ Нет зависимостей
- ✅ Быстро (lookup в словаре)
- ✅ Предсказуемый результат
- ✅ Покрывает 80-90% случаев

**Недостатки:**
- ❌ Не работает для редких/новых слов
- ❌ Нужно вручную составлять словарь

**Источники словарей:**
- Викисловарь (Wiktionary) - русский раздел с ударениями
- OpenCorpora - открытый корпус с разметкой
- Грамота.ру - словарь ударений
- https://github.com/danakt/russian-words - список русских слов

### Подход 2: Простые правила + словарь исключений
**Идея:** Использовать базовые правила русского языка + словарь для омографов

**Примеры правил:**
- Односложные слова не требуют ударения
- В словах на -ость, -ность часто ударение на корень
- Словарь только для омографов: замок/замок, мука/мука

### Подход 3: API сервисы (онлайн)
**Варианты:**
- Яндекс Dictionary API (если есть ударения)
- Грамота.ру (нет официального API, но есть сайт)

**Недостатки:**
- ❌ Требует интернет
- ❌ Задержка на запросах
- ❌ Ограничения по количеству запросов

### Подход 4: Легкая ML модель (ONNX)
**Идея:** Найти готовую ONNX модель для ударений (без TensorFlow)

**Преимущества:**
- ✅ Работает offline
- ✅ Легче TensorFlow
- ✅ Хорошая точность

**Недостатки:**
- ❌ Нужно найти готовую модель
- ❌ Все равно зависимость от onnxruntime

## Рекомендуемое решение: Гибридный подход

### Этап 1: Базовый словарь (быстрый старт)
1. Создать словарь из 1000-2000 самых частых слов с ударениями
2. Добавить все омографы
3. Добавить технические термины (робот, навигация, сенсор, и т.д.)

### Этап 2: Опциональное улучшение
Если базового словаря недостаточно:
1. Попробовать найти ONNX модель
2. Или использовать API в качестве fallback для неизвестных слов

## Реализация базового словаря

### Структура:
```python
ACCENT_DICT = {
    # Омографы (обязательно!)
    'замок_здание': 'з+амок',
    'замок_устройство': 'зам+ок',
    'мука_продукт': 'м+ука',
    'мука_страдание': 'мук+а',
    'белки_животные': 'б+елки',
    'белки_протеин': 'белк+и',
    
    # Частые слова
    'робот': 'р+обот',
    'система': 'сист+ема',
    'навигация': 'навиг+ация',
    'сенсор': 'с+енсор',
    # ... ещё ~1000 слов
    
    # Топонимы
    'сочи': 'С+очи',
    'москва': 'Москв+а',
    'россия': 'Росс+ия',
}
```

### Функции:
```python
def add_accents(text: str, context: dict = None) -> str:
    """
    Расставляет ударения используя словарь
    
    Args:
        text: Входной текст
        context: Контекст для разрешения омографов
    """
    words = text.split()
    result = []
    
    for word in words:
        word_lower = word.lower().strip('.,!?;:')
        
        # Проверка в словаре
        if word_lower in ACCENT_DICT:
            accented = ACCENT_DICT[word_lower]
            # Восстановить регистр и пунктуацию
            result.append(accented)
        else:
            result.append(word)
    
    return ' '.join(result)
```

## Источники для словаря

### 1. Частотный словарь русского языка
- http://dict.ruslang.ru/freq.php
- Sharoff frequency list

### 2. Викисловарь
- https://ru.wiktionary.org
- Можно скачать дамп и распарсить

### 3. OpenCorpora
- http://opencorpora.org
- Открытый корпус с морфологической разметкой

### 4. Готовые списки
- https://github.com/danakt/russian-words
- https://github.com/hingston/russian

## Следующие шаги

1. ✅ Создать базовый модуль `accent_dict.py` со словарём
2. ✅ Заполнить словарь:
   - Омографы (~50 пар)
   - Частые слова (~500-1000)
   - Технические термины (~100)
   - Топонимы (~50)
3. ✅ Интегрировать в `text_normalizer.py`
4. ⏳ Тестировать и дополнять словарь по мере использования
5. ⏳ (Опционально) Добавить ML модель для редких слов

## Выводы

- **Лучший вариант для старта:** Словарь частых слов
- **Достаточно для робота:** 80-90% покрытие обычных случаев
- **Расширяемость:** Легко добавлять новые слова
- **Без зависимостей:** Не требует ML библиотек
- **Предсказуемость:** Всегда одинаковый результат

Для робота-ассистента этого вполне достаточно!
