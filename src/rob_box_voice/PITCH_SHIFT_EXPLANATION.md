# –≠—Ñ—Ñ–µ–∫—Ç "–ë—É—Ä—É–Ω–¥—É–∫–∞" –≤ ROBBOX Voice - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –û–±—ä—è—Å–Ω–µ–Ω–∏–µ

## –ü—Ä–æ–±–ª–µ–º–∞: –ì–æ–ª–æ—Å –∑–≤—É—á–∏—Ç –≤—ã—à–µ –∏ –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ WM8960

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

–í –≤–∞—à–µ–º —Ä–∞–±–æ—á–µ–º —Å–∫—Ä–∏–ø—Ç–µ –≥–æ–ª–æ—Å ROBBOX –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã–º "—ç—Ñ—Ñ–µ–∫—Ç–æ–º –±—É—Ä—É–Ω–¥—É–∫–∞" - –∑–≤—É—á–∏—Ç –≤—ã—à–µ –∏ –±—ã—Å—Ç—Ä–µ–µ —á–µ–º –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ –æ—Ç Yandex TTS.

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–∏—á–∏–Ω–∞

```python
def play_audio_segment(audio_data):
    # 1. –ü–æ–ª—É—á–∞–µ–º —á–∞—Å—Ç–æ—Ç—É –∑–≤—É–∫–æ–≤–æ–π –∫–∞—Ä—Ç—ã WM8960
    device_info = sd.query_devices(None, "output")
    target_rate = int(device_info["default_samplerate"])  # = 44100 Hz
    
    # 2. –ß–∏—Ç–∞–µ–º –°–´–†–´–ï –±–∞–π—Ç—ã WAV –ë–ï–ó –∑–∞–≥–æ–ª–æ–≤–∫–∞
    samples = np.frombuffer(audio_data, dtype=np.int16).astype(np.float32) / 32768.0
    
    # 3. –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –Ω–∞ —á–∞—Å—Ç–æ—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    sd.play(samples, samplerate=target_rate, blocking=True)  # ‚ö†Ô∏è –ò–°–ö–ê–ñ–ï–ù–ò–ï!
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Yandex TTS –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç WAV —Å —á–∞—Å—Ç–æ—Ç–æ–π **22050 Hz** (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞ –∞–Ω—Ç–æ–Ω–∞)
- `np.frombuffer()` —á–∏—Ç–∞–µ—Ç –¢–û–õ–¨–ö–û PCM –¥–∞–Ω–Ω—ã–µ, **–∏–≥–Ω–æ—Ä–∏—Ä—É—è –∑–∞–≥–æ–ª–æ–≤–æ–∫ WAV** —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —á–∞—Å—Ç–æ—Ç–µ
- `sd.play(samples, samplerate=44100)` –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –Ω–∞ —á–∞—Å—Ç–æ—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ WM8960

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
Pitch shift = 44100 / 22050 = 2.0x
–°–∫–æ—Ä–æ—Å—Ç—å = 2.0x –±—ã—Å—Ç—Ä–µ–µ
–¢–æ–Ω = –Ω–∞ –æ–∫—Ç–∞–≤—É –≤—ã—à–µ
```

### –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Raspberry Pi —Å WM8960

–ù–∞ ROBOT001 –∑–≤—É–∫–æ–≤–∞—è –∫–∞—Ä—Ç–∞ WM8960:
```bash
ros2@ROBOT001:~$ aplay -l
card 0: wm8960soundcard [wm8960-soundcard], device 0: 3f203000.i2s-wm8960-hifi wm8960-hifi-0
```

Default samplerate = **44100 Hz** ‚Üí —Ä–æ–≤–Ω–æ –≤ 2 —Ä–∞–∑–∞ –≤—ã—à–µ —á–µ–º 22050 Hz –æ—Ç TTS.

### –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–±–µ–∑ –∏—Å–∫–∞–∂–µ–Ω–∏–π)

```python
import soundfile as sf

def play_audio_segment_correct(audio_data):
    # 1. –ß–∏—Ç–∞–µ–º WAV –° –∑–∞–≥–æ–ª–æ–≤–∫–æ–º - –ø–æ–ª—É—á–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —á–∞—Å—Ç–æ—Ç—É
    import io
    data, original_rate = sf.read(io.BytesIO(audio_data))  # original_rate = 22050
    
    # 2. –ü–æ–ª—É—á–∞–µ–º —á–∞—Å—Ç–æ—Ç—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    device_info = sd.query_devices(None, "output")
    target_rate = int(device_info["default_samplerate"])  # = 44100
    
    # 3. –†–µ—Å–µ–º–ø–ª–∏—Ä—É–µ–º –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    if original_rate != target_rate:
        import librosa
        data = librosa.resample(data, orig_sr=original_rate, target_sr=target_rate)
    
    # 4. –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —á–∞—Å—Ç–æ—Ç–µ
    sd.play(data, samplerate=target_rate, blocking=True)  # ‚úÖ –ë–ï–ó –∏—Å–∫–∞–∂–µ–Ω–∏–π
```

### –î–ª—è –¥–∞—Ç–∞—Å–µ—Ç–∞ TTS training

**–í–ê–ñ–ù–û:** –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª—ã **–ë–ï–ó —Ä–µ—Å–µ–º–ø–ª–∏–Ω–≥–∞** (–æ—Ä–∏–≥–∏–Ω–∞–ª 22050 Hz):

```python
def save_audio(self, audio_data: bytes, output_path: Path):
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º WAV –∫–∞–∫ –µ—Å—Ç—å –æ—Ç Yandex (22050 Hz, PCM_16, mono)
    with open(output_path, 'wb') as f:
        f.write(audio_data)  # ‚úÖ –û–†–ò–ì–ò–ù–ê–õ–¨–ù–û–ï –∫–∞—á–µ—Å—Ç–≤–æ
```

### Comparison

| –ú–µ—Ç–æ–¥ | –ß–∞—Å—Ç–æ—Ç–∞ | Pitch | –ó–≤—É—á–∞–Ω–∏–µ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|-------|---------|-------|----------|---------------|
| `np.frombuffer()` + 44100 Hz | 22050‚Üí44100 | 2.0x –≤—ã—à–µ | "–ë—É—Ä—É–Ω–¥—É–∫" | –í–∞—à ROBBOX —Å–∫—Ä–∏–ø—Ç |
| `soundfile.read()` + resample | 22050‚Üí44100 | –ù–æ—Ä–º–∞–ª—å–Ω—ã–π | –ö–∞–∫ –æ—Ç Yandex | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |
| –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞ | 22050 | –ù–æ—Ä–º–∞–ª—å–Ω—ã–π | –ö–∞–∫ –æ—Ç Yandex | TTS training |

### –í—ã–≤–æ–¥

–≠—Ñ—Ñ–µ–∫—Ç "–±—É—Ä—É–Ω–¥—É–∫–∞" - —ç—Ç–æ **–Ω–µ –±–∞–≥, –∞ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å** –≤–∞—à–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–∑–¥–∞—ë—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –≥–æ–ª–æ—Å ROBBOX! 

–î–ª—è –æ–±—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º **–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã 22050 Hz**, –∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ —Ä–æ–±–æ—Ç–µ –±—É–¥–µ—Ç —Å —Ç–µ–º –∂–µ –∏—Å–∫–∞–∂–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ `np.frombuffer()`.

## Frequency Analysis

```
Original Yandex TTS: 22050 Hz (—Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è —Ä–µ—á–∏)
WM8960 default rate: 44100 Hz (–∞—É–¥–∏–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç CD quality)

Ratio: 44100 / 22050 = 2.0

Effect:
- Playback speed: 2x faster  
- Pitch: +12 semitones (1 octave)
- Duration: 0.5x shorter
```

## Example

–§—Ä–∞–∑–∞ "–ü—Ä–∏–≤–µ—Ç! –Ø —Ä–æ–±–æ—Ç" (9.53 —Å–µ–∫ –ø—Ä–∏ 0.4 speed):
- –û—Ä–∏–≥–∏–Ω–∞–ª 22050 Hz: –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –≥–æ–ª–æ—Å –∞–Ω—Ç–æ–Ω–∞
- –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ 44100 Hz: ~4.77 —Å–µ–∫, –≥–æ–ª–æ—Å –≤—ã—à–µ, –∑–≤—É—á–∏—Ç –∫–∞–∫ "–¥–µ—Ç—Å–∫–∏–π —Ä–æ–±–æ—Ç"

–≠—Ç–æ –∏ –µ—Å—Ç—å —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π –∑–≤—É–∫ ROBBOX! ü§ñ
