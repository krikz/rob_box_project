# Энергосбережение и оптимизация сетевой архитектуры ROS 2/Zenoh

## Введение

ROS 2 традиционно использует DDS для передачи данных между узлами, что удобно, но может приводить к перегрузке сети и потере сообщений, особенно в нестабильных или многопользовательских сетях. Альтернативный протокол Zenoh позволяет гибко настраивать маршрутизацию, снижать лишний трафик и работать через интернет без VPN.

---

## Рекомендации по снижению энергопотребления и оптимизации сети

### 1. Проблемы DDS
- Перегрузка сети, особенно при нестабильном Wi-Fi.
- Сложная диагностика, возможны потери сообщений.
- Риск парализации сети при большом количестве устройств.

### 2. Альтернатива: Zenoh (RMW Zenoh)
- Современный протокол, оптимизированный для роботов и облака.
- Гибкая маршрутизация, снижение лишнего трафика.
- Возможность работы через интернет без VPN.

### 3. Базовая настройка Zenoh
- Установить Zenoh (пока из исходников, в будущем — через apt).
- На каждом устройстве задать переменную окружения:
  ```bash
  export RMW_IMPLEMENTATION=rmw_zenoh
  ```
- Для постоянного использования — добавить в `.bashrc`.

### 4. Запуск Zenoh Router
- Запускать маршрутизатор вручную:
  ```bash
  zenohd --config zenoh_router_config.json5
  ```
- После обнаружения узлы могут общаться напрямую.

### 5. Пример конфигурации для соединения устройств
- Узнать IP:
  ```bash
  ip a
  ```
- В конфиге второго устройства добавить endpoint:
  ```json
  "connect": [
    "tcp/192.168.8.179:7447"
  ]
  ```
- Экспортировать переменную:
  ```bash
  export ZENOH_ROUTER_CONFIG=router_config.json5
  zenohd --config $ZENOH_ROUTER_CONFIG
  ```

### 6. Альтернативные сценарии
- Можно запускать только один маршрутизатор, а на других устройствах указать сессию для подключения к нему:
  ```bash
  export ZENOH_SESSION_CONFIG=session_config.json5
  ```
- В конфиге сессии указать IP основного маршрутизатора.

### 7. Мультикаст (multicast) для автообнаружения
- В конфиге сессии включить multidiffusion:
  ```json
  "multidiffusion": true
  ```
- Экспортировать переменную:
  ```bash
  export ZENOH_SESSION_CONFIG=session_config.json5
  ```

### 8. Передача данных через интернет
- Запустить облачный маршрутизатор (например, на DigitalOcean).
- В конфиге локальных маршрутизаторов указать endpoint облачного маршрутизатора.
- Все устройства будут соединяться через облако, без VPN.

### 9. Энергосбережение и оптимизация
- Используйте Zenoh для снижения лишнего сетевого трафика.
- Запускайте только необходимые маршрутизаторы.
- Отключайте лишние узлы и сервисы.
- Храните конфиги в отдельной папке, не изменяйте дефолтные файлы — делайте копии.

---

## Краткие команды для настройки Zenoh

```bash
# Установить Zenoh (пример для сборки из исходников)
git clone https://github.com/eclipse-zenoh/zenoh.git
cd zenoh
cargo build --release

# Экспорт переменной для использования Zenoh
export RMW_IMPLEMENTATION=rmw_zenoh

# Запуск маршрутизатора с кастомным конфигом
export ZENOH_ROUTER_CONFIG=router_config.json5
zenohd --config $ZENOH_ROUTER_CONFIG

# Экспорт переменной для сессии
export ZENOH_SESSION_CONFIG=session_config.json5

# Проверить IP устройства
ip a
```

---

**Рекомендация:**
Внедрите Zenoh для оптимизации энергопотребления и сетевой архитектуры, используйте приведённые сценарии и команды для гибкой настройки под ваши задачи.
